/*! kalzate-client 16-01-2014 */
!function(a){function b(a){var b="01",c={};for(var d in a){var e=parseInt(b,2);c[a[d]]={bitMask:e,title:a[d]},b=(e<<1).toString(2)}return c}function c(a,b){var c={};for(var d in a)if("string"==typeof a[d])if("*"==a[d]){var e="";for(var f in b)e+="1";c[d]={bitMask:parseInt(e,2),title:a[d]}}else console.log("Access Control Error: Could not parse '"+a[d]+"' as access definition for level '"+d+"'");else{var e=0;for(var f in a[d])b.hasOwnProperty(a[d][f])?e|=b[a[d][f]].bitMask:console.log("Access Control Error: Could not find role '"+a[d][f]+"' in registered roles while building access for '"+d+"'");c[d]={bitMask:e,title:a[d][f]}}return c}var d={roles:["public","employee","admin"],accessLevels:{"public":"*",anon:["public"],employee:["employee","admin"],admin:["admin"]}};a.userRoles=b(d.roles),a.accessLevels=c(d.accessLevels,a.userRoles)}("undefined"==typeof exports?this.routingConfig={}:exports),angular.module("kalzate",["kalzate.filters","kalzate.services","kalzate.directives","kalzate.controllers","ngCookies","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){var e=routingConfig.accessLevels;a.state("index",{url:"/",templateUrl:"/static/partials/home.html",access:e.employee}).state("login",{url:"/login",templateUrl:"/static/partials/login.html",controller:"LoginCtrl",access:e.anon}).state("register",{url:"/register",templateUrl:"/static/partials/register.html",controller:"RegisterCtrl",access:e.anon}).state("recover",{url:"/recover",templateUrl:"/static/partials/recover.html",controller:"RecoverCtrl",access:e.anon}).state("shoes",{url:"/shoes",templateUrl:"/static/partials/shoes.html",controller:"ShoesCtrl",access:e.employee}).state("shoes.page",{url:"/page/{pageNo}",controller:"ShoesPageCtrl",access:e.employee}).state("shoes.onemore",{url:"/onemore",templateUrl:"/static/partials/shoe_onemore.html",controller:"OnemoreShoeCtrl",access:e.employee}).state("shoes.search",{url:"/search",templateUrl:"/static/partials/shoe_search.html",controller:"SearchShoeCtrl",access:e.employee}).state("newShoe",{url:"/shoes/new",templateUrl:"/static/partials/shoe_new.html",controller:"NewShoeCtrl",access:e.employee}).state("editShoe",{url:"/shoes/edit/:id",templateUrl:"/static/partials/shoe_edit.html",controller:"EditShoeCtrl",access:e.employee}).state("tickets",{url:"/tickets?box",resolve:{emit:["$rootScope",function(a){return a}]},templateUrl:"/static/partials/tickets.html",controller:"TicketsCtrl",onExit:["emit",function(a){a.$broadcast("removeTicketId")}],access:e.employee}).state("tickets.return",{url:"/return/:code",templateUrl:"/static/partials/tickets_return.html",controller:"TicketsReturnCtrl",access:e.employee}).state("tickets.reserve",{url:"/reservas/:code",templateUrl:"/static/partials/tickets_reserve.html",controller:"TicketsReserveCtrl",access:e.employee}).state("error",{url:"/404",templateUrl:"/static/partials/404.html",access:e.public}),b.otherwise("/404"),c.html5Mode(!0);var f=["$location","$q",function(a,b){function c(a){return a}function d(c){return 401===c.status&&a.path("/login"),b.reject(c)}return function(a){return a.then(c,d)}}];d.responseInterceptors.push(f)}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(d,e){a.error=null,c.authorize(e.access)||(c.isLoggedIn()?b.path("/"):(a.transition=b.path(),b.path("/login")),d.preventDefault())})}]);var kzServices=angular.module("kalzate.services",[]);kzServices.factory("Auth",["$http","$cookieStore","$rootScope",function(a,b,c){function d(a){angular.extend(g,a),b.put("kz-user",g)}var e=routingConfig.accessLevels,f=routingConfig.userRoles,g=b.get("kz-user")||{username:"",role:f.public};return{authorize:function(a,b){return b=b||g.role,a.bitMask&b.bitMask},isLoggedIn:function(a){return a=a||g,a.role.title==f.employee.title||a.role.title==f.admin.title},register:function(b,c,e){a.post("/api/register",b).success(function(a){d(a),c()}).error(e)},login:function(b,c,e){a.post("/api/login",b).success(function(a){d(a),c(a)}).error(e)},logout:function(c,e){a.post("/api/logout").success(function(){d({username:"",role:f.public}),b.remove("kz-user"),c()}).error(e)},setUserName:function(a){var b=g.username;d(a),c.$broadcast("usernameChanged",{before:b,current:g.username})},accessLevels:e,userRoles:f,user:g}}]),kzServices.factory("Colors",function(){var a=[{color:"AZUL",code:"#0000FF"},{color:"AZUL MARINO",code:"#120A8F"},{color:"BEIS",code:"#F5DEB3"},{color:"CAFE",code:"#964B00"},{color:"CHOCOLATE",code:"#845331"},{color:"CAMELLO",code:"#C19A6B"},{color:"FUCSIA",code:"#FD3F92"},{color:"GRIS",code:"#bebebe"},{color:"HIELO",code:"#A5F2F3"},{color:"KAQUI",code:"#f0e68c"},{color:"MARRON",code:"#964B00"},{color:"NEGRO",code:"#000"},{color:"ORO",code:"#ffd700"},{color:"PLATA",code:"#C0C0C0"},{color:"PURPURA",code:"#660099"},{color:"ROSA",code:"#FFC0CB"},{color:"ROJO",code:"#FF0000"},{color:"TAUPE",code:"#483C32"},{color:"VERDE",code:"#00FF00"},{color:"VERDE OSCURO",code:"#006400"},{color:"NEGRO/FUCSIA",code:"#000",code2:"#FD3F92"},{color:"NARANJA",code:"#DF7D00"},{color:"AZUL/BLANCO",code:"#0000FF",code2:"#FFF"},{color:"NEGRO/GRIS",code:"#000",code2:"#bebebe"}],b=function(b){for(var c=0;c<a.length;c++)if(a[c].color==b)return a[c].code};return{colorList:a,getColorCode:b}}),kzServices.factory("Converter",function(){"use strict";function a(a,b){var c=b.toString(),d=c.substring(1,c.lastIndexOf("/")),e=c.substring(c.lastIndexOf("/")+1);return-1===e.indexOf("g")&&(b=new RegExp(d,e+"g")),a.split(b)}function b(a){return""===a.replace(/^[\s]*|[\s]*$/g,"")}function c(a){var c;for(c=0;c<a.length;c++)b(a[c])&&a.splice(c--,1)}function d(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(e=a[c].replace(/^[\s]*|[\s]*$/g,""),f="",('"'===e.charAt(0)||"'"===e.charAt(0))&&(f=e.charAt(0)),""!==f&&e.slice(-1)!==f){for(d=c+1,d<a.length&&(e=a[d].replace(/^[\s]*|[\s]*$/g,""));d<a.length&&e.slice(-1)!==f;)a[c]+=b+a.splice(d,1)[0],e=a[d].replace(/[\s]*$/g,"");d<a.length&&(a[c]+=b+a.splice(d,1)[0])}}function e(a){var b;for(b=0;b<a.length;b++)a[b]=a[b].replace(/^[\s]*|[\s]*$/g,"")}function f(a){var b;for(b=0;b<a.length;b++)'"'===a[b].charAt(0)?a[b]=a[b].replace(/^"|"$/g,""):"'"===a[b].charAt(0)&&(a[b]=a[b].replace(/^'|'$/g,""))}function g(a,b){var c=a.split(b);return d(c,b),e(c),f(c),c}function h(a,b){var c,d=[];for(c=0;c<a.length;c++)d[c]=g(a[c],b);return d}function i(a){var b,c,d,e,f,g=[],h=a[0];for(b=1;b<a.length;b++)if(d=a[b],d.length>0){if(d.length>h.length)throw new SyntaxError("not enough header fields");for(e={},c=0;c<h.length;c++)f=h[c],e[f]=c<d.length?d[c]:"";g.push(e)}return g}return{csv2json:function(b,d,e,f){var g,j,k,l={lineEnding:/[\r\n]/,delimiter:",",ignoreEmptyLines:!0};if(""===b)throw new SyntaxError("empty input");if("undefined"!=typeof d&&(l.lineEnding=d instanceof RegExp?d:new RegExp("["+String(d)+"]","g")),"undefined"!=typeof e&&(l.delimiter=String(e)),"undefined"!=typeof f&&(l.ignoreEmptyLines=!!f),g=a(b,l.lineEnding),l.ignoreEmptyLines&&c(g),g.length<2)throw new SyntaxError("missing header");return j=h(g,l.delimiter),k=i(j)},json2csv:function(a){var b="object"!=typeof a?JSON.parse(a):a,c="",d="";if($("#labels").is(":checked")){{b[0]}if($("#quote").is(":checked"))for(var e in b[0]){var f=e+"";d+='"'+f.replace(/"/g,'""')+'",'}else for(var e in b[0])d+=e+",";d=d.slice(0,-1),c+=d+"\r\n"}for(var g=0;g<b.length;g++){var d="";if($("#quote").is(":checked"))for(var e in b[g]){var f=b[g][e]+"";d+='"'+f.replace(/"/g,'""')+'",'}else for(var e in b[g])d+=b[g][e]+",";d=d.slice(0,-1),c+=d+"\r\n"}return c}}}),kzServices.factory("Printer",function(){function a(e){if(b.isDoneFinding()){if(c=b.getPrinter(),!c)return e(!0);d=!0,e(!1)}else setTimeout(function(){a(e)},500)}var b,c,d=!1,e=function(c,e){return b&&d?e(!1):(c=c||"termica",b=document.getElementById("qz"),"undefined"!=typeof b.findPrinter?(b.findPrinter(c),a(e)):e(!0),void 0)};return{change:function(a,b){a&&(d=!1,e(a,b))},getName:function(){return c},print:function(a,c){e(a.printer,function(e){if(!e)try{b.appendHex("x1Bx40"),a.openCashDrawer&&b.appendHex("x1Bx70x00x09x09"),b.append(a.content),a.cut&&b.appendHex("x1Bx69"),b.print()}catch(f){if(alert("UN ERROR HA OCURRIDO AL IMPRIMIR; CONTACTA AL ADMINISTRADOR"),d=!1,c)return c(e)}c&&c(e)})}}}),angular.module("kalzate.controllers",[]).controller("LoginCtrl",["$rootScope","$scope","$location","$window","Auth",function(a,b,c,d,e){b.error=!1,b.login=function(){e.login({username:b.username,password:b.password},function(){b.error=!1,c.path(a.transition||"/")},function(){b.error=!0})},b.loginOauth=function(a){d.location.href="/auth/"+a}}]).controller("RegisterCtrl",["$scope","$location","Auth",function(a,b,c){a.serverError=!1,a.register=function(){c.register({username:a.username,email:a.email,password:a.password},function(){a.serverError=!1,b.path("/")},function(){a.serverError=!0})}}]).controller("RecoverCtrl",["$scope","$http",function(a,b){a.serverNotice={visible:!1,code:-1},a.recover=function(){a.serverNotice.visible=!1,b.post("/api/recover",{email:a.email}).success(function(){a.serverNotice.code=0,a.serverNotice.visible=!0}).error(function(){a.serverNotice.code=1,a.serverNotice.visible=!0})}}]).controller("FooterCtrl",["$http","$scope","$location","Auth","$modal",function(a,b,c,d,e){b.user=d.user,b.shutdown=function(){a.post("/api/utils/shutdown").success(function(){delete localStorage.sessTickets,delete localStorage.boxes,c.path("/login")}).error(function(){})},b.logout=function(){d.logout(function(){delete localStorage.sessTickets,delete localStorage.boxes,c.path("/login")},function(){})},b.openEdit=function(){var a=e.open({templateUrl:"ModalEditUser.html",controller:"ModalEditUserCtrl",backdrop:"static",keyboard:!1});a.result.then(function(a){a.username&&d.setUserName(a)})}}]).controller("ModalEditUserCtrl",["$scope","$http","$modalInstance",function(a,b,c){a.error=!1,a.edit=function(){a.error=!1,b.post("/api/user/edit",{username:a.username,password:a.password}).success(function(){a.error=!1,c.close({username:a.username})}).error(function(){a.error=!0})},a.cancel=function(){c.dismiss("cancel")}}]).controller("NavCtrl",["$scope","$window",function(a,b){a.navCollapsed=!1,a.toTickets=function(){b.location.href="/tickets"},a.genID=1,a.updateID=function(){a.genID=Math.floor(1e3*Math.random()+1)}}]).controller("ShoesCtrl",["$scope","$http","$cookieStore","$location","Colors","$modal",function(a,b,c,d,e,f){var g;a.progress=!1,a.pagination={totalItems:0,currentPage:1,maxSize:5,itemsPerPage:parseInt(localStorage["kz-stock-ipp"])||10,setPage:function(b){a.pagination.currentPage=b;for(var c=0,d=a.pagination.itemsPerPage,e=1;b>e;e++,c+=d);a.pagination.getItems(c,d)},setItemsPerPage:function(){localStorage["kz-stock-ipp"]=a.pagination.itemsPerPage,a.pagination.setPage(a.pagination.currentPage)},getItems:function(c,d){a.progress=!0,b.post("/api/shoes",{search:a.searching,order:a.order,offset:c,limit:d}).success(function(b){a.pagination.totalItems=b.count,a.items=b.items,a.progress=!1})},search:function(){var b=1;""==a.query.reference&&""==a.query.brand&&""==a.query.size&&""==a.query.reference&&""==a.query.category&&""==a.query.color?(a.searching=!1,b=g):(a.searching={},a.query.reference&&(a.searching.reference=a.query.reference),a.query.brand&&(a.searching.brand=a.query.brand),a.query.size&&(a.searching.size=a.query.size),a.query.category&&(a.searching.category=a.query.category),a.query.color&&(a.searching.color="object"==typeof a.query.color?a.query.color.color:a.query.color),g=a.pagination.currentPage),a.pagination.setPage(b)}},a.searching=!1,a.query={reference:"",size:"",brand:"",category:"",color:""},a.colors=e.colorList,a.getColorCode=e.getColorCode,a.items_modified=!0,a.references=[],b.post("/api/shoes/fields",{field:"reference"}).success(function(b){a.references=b}),a.delSearch=function(){a.query={reference:"",size:"",brand:"",category:"",color:""},a.pagination.search()},a.updateSearch=function(b){if(""==a.query[b]&&a.searching){var c=!1;for(var d in a.query)if(d!=b&&""!=a.query[d]){c=!0;break}c?a.pagination.search():(a.searching=!1,a.pagination.setPage(g))}},a.caret={reference:!0,size:!0,brand:!0,quantity:!0,color:!0,price:!0,category:!0},a.order={_id:-1},a.orderShoes=function(b){b in a.order?a.order[b]*=-1:(a.order={},a.order[b]=-1),a.caret[b]=!a.caret[b],a.pagination.setPage(a.pagination.currentPage)},a.removeShoe=function(c){b.post("/api/shoes/remove",{id:c}).success(function(){a.pagination.setPage(a.pagination.currentPage)})},a.editShoe=function(a){d.path("/shoes/edit/"+a)},a.barCode=function(a){f.open({templateUrl:"ModalBCShoes.html",controller:"ModalBCShoesCtrl",backdrop:"static",keyboard:!1,resolve:{barcode:function(){return a}}})},a.qrCode=function(b,c,d){var e=f.open({templateUrl:"ModalQRShoes.html",controller:"ModalQRShoesCtrl",backdrop:"static",keyboard:!1,resolve:{info:function(){return{id:b,has_qr:c}}}});e.result.then(function(){a.items[d].has_qr=!0})},a.openPrint=function(){var b=f.open({templateUrl:"ModalPrintShoes.html",controller:"ModalPrintShoesCtrl",backdrop:"static",keyboard:!1,resolve:{modified:function(){return a.items_modified}}});b.result.then(function(){a.items_modified=!1})},a.openImport=function(){var c=f.open({templateUrl:"ModalImportShoes.html",controller:"ModalImportShoesCtrl",backdrop:"static",keyboard:!1});c.result.then(function(){b.post("/api/shoes/fields",{field:"reference"}).success(function(b){a.references=b,a.items_modified=!0,a.pagination.setPage(1)})})},-1==d.path().indexOf("page")&&a.pagination.getItems(0,a.pagination.itemsPerPage)}]).controller("ModalImportShoesCtrl",["$scope","$http","Converter","$modalInstance",function(a,b,c,d){a.files=[],a.fileError={code:0,msg:"",visible:!1},a.progress=!1,a.displayCSV=!1,a.remove=!1,a.ok=function(){a.progress=!0;for(var c=[],e=0;e<a.files.length;e++)c=c.concat(a.files[e].data);b.post("/api/shoes/import",{items:c,remove:a.remove}).success(function(){d.close()}).error(function(){a.fileError.code=3,a.fileError.visible=!0,a.progress=!1})},a.display=function(){a.displayCSV=!0},a.cancel=function(){d.dismiss("cancel")},a.closeTab=function(b){~b&&(a.files.splice(b,1),a.files.length||(a.displayCSV=!1))},a.newFile=function(b){try{for(var d=0;d<a.files.length;d++)if(a.files[d].name==b.name)return;b.data=c.csv2json(b.data),a.files.push(b)}catch(e){console.log(e),a.fileError.code=0,a.fileError.msg="El fichero CSV contiene errores",a.fileError.visible=!0}}}]).controller("ModalPrintShoesCtrl",["$scope","$http","$modalInstance","modified",function(a,b,c,d){a.progress=!0,a.error=!1,d?b.get("/api/shoes/export/pdf").success(function(){a.pdf="/static/barcodes/zapatos_barcodes.pdf",a.progress=!1}).error(function(){a.progress=!1,a.error=!0}):(a.pdf="/static/barcodes/zapatos_barcodes.pdf",a.progress=!1),a.ok=function(){c.close()}}]).controller("ModalQRShoesCtrl",["$scope","$http","$modalInstance","info",function(a,b,c,d){a.progress=!0,a.error=!1,a.qr="",b.post("/api/shoes/qr",d).success(function(b){a.qr=b.qr,a.progress=!1}).error(function(){a.progress=!1,a.error=!0}),a.ok=function(){c.close()},a.print=function(){var b=window.open("","Imprimir foto","height=400,width=600");b.document.write("<html><head>"),b.document.write('</head><body ><img src="'),b.document.write(a.qr),b.document.write('" /></body></html>'),b.document.close(),b.print()}}]).controller("ModalBCShoesCtrl",["$scope","$http","$modalInstance","barcode",function(a,b,c,d){a.progress=!0,a.error=!1,a.barcode="/static/barcodes/"+d+".png",a.onError=function(){b.post("/api/shoes/barcode",{barcode:d}).success(function(b){a.barcode=b,a.progress=!1}).error(function(){a.progress=!1,a.error=!0})},a.onLoad=function(){a.progress=!1},a.ok=function(){c.close()},a.print=function(){var b=window.open("","Imprimir foto","height=400,width=600");b.document.write("<html><head>"),b.document.write('</head><body ><img src="'),b.document.write(a.barcode),b.document.write('" /></body></html>'),b.document.close(),b.print()}}]).controller("ShoesPageCtrl",["$scope","$stateParams","$http",function(a,b){var c=b.pageNo||1;a.pagination.currentPage=c;for(var d=0,e=a.pagination.itemsPerPage,f=1;c>f;f++,d+=e);a.pagination.getItems(d,e)}]).controller("OnemoreShoeCtrl",["$scope","$http",function(a,b){a.color="",a.category="MUJERES",a.addShoe=function(){var c={reference:a.reference.toUpperCase(),brand:a.brand.toUpperCase(),category:a.category,size:a.size,color:a.color.color?a.color.color:a.color,price:a.price,quantity:a.quantity};b.post("/api/shoes/add",c).success(function(b){if(b){if(a.pagination.totalItems+=1,a.references.push(c.reference),a.searching)return a.pagination.search();a.items.length<a.pagination.itemsPerPage?a.items.unshift(b):(a.items.pop(),a.items.unshift(b)),a.items_modified=!0}else alert("Oh No!, tenemos un problema, consulta al administrador con este codigo: OnemoreShoeCtrl-addShoe")}).error(function(a){alert("Oh No!, un error detectado consulta al administrador con este codigo: "+a)})},a.reset=function(){a.reference="",a.brand="",a.category="MUJERES",a.size="",a.color="",a.price="",a.quantity=""}}]).controller("SearchShoeCtrl",["$scope","$http",function(a,b){a.brands=[],b.post("/api/shoes/fields",{field:"brand"}).success(function(b){a.brands=b})}]).controller("NewShoeCtrl",["$scope","$http","$location","Colors","Auth",function(a,b,c,d,e){a.images=[],a.imagesError={code:0,msg:"",visible:!1},a.progress=!1,a.color="",a.category="MUJERES",a.season="INVIERNO",a.colors=d.colorList,a.keywords="",a.newFile=function(c){a.progress=!0,b.post("/api/upload",c).success(function(b){a.progress=!1,c.url=b,a.images.push(c)}).error(function(){a.imagesError.code=3,a.imagesError.visible=!0,a.progress=!1})},a.closeImg=function(b){a.images.splice(b,1)},a.create=function(){a.progress=!0;for(var d=[],f=0;f<a.images.length;f++)d.push(a.images[f].url);var g={reference:a.reference.toUpperCase(),brand:a.brand.toUpperCase(),category:a.category,size:a.size,color:a.color.color,price:a.price,quantity:a.quantity,season:a.season,maker:a.maker,provider:a.provider,location:a.location,keywords:a.keywords.split(",")||[],description:a.description,comments:[{text:a.comments,date:new Date,employee:e.user.username}],images:d};b.post("/api/shoes/add",g).success(function(b){b?c.path("/shoes"):(a.imagesError.code=4,a.imagesError.visible=!0),a.progress=!1}).error(function(){a.imagesError.code=4,a.imagesError.visible=!0,a.progress=!1})},a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},a.submit=function(){var a=document.getElementById("stock-add-form");if(Event)a.dispatchEvent(new Event("submit"));else if(document.createEvent){var b=document.createEvent("HTMLEvents");b.initEvent("submit",!0,!1),a.dispatchEvent(b)}else if(document.createEventObject){var b=document.createEventObject();a.fireEvent("onSubmit",b)}}}]).controller("EditShoeCtrl",["$scope","$http","$location","Colors","Auth","$stateParams",function(a,b,c,d,e,f){var g=f.id;a.initProgress=!0,a.imagesError={code:0,msg:"",visible:!1},a.progress=!1,a.colors=d.colorList,b.get("/api/shoes/get/"+encodeURI(g)).success(function(b){a.reference=b.reference,a.brand=b.brand,a.size=b.size,a.color=b.color,b.price>0&&(a.price=parseFloat(b.price)),b.quantity>0&&(a.quantity=b.quantity),a.category=b.category||"",a.season=b.season||"",a.maker=b.maker||"",a.provider=b.provider||"",a.keywords=b.keywords.join(",")||"",a.location=b.location||"",a.description=b.description||"",a.images=[];for(var c=0;c<b.images.length;c++){var d=b.images[c];a.images.push({data:d,name:d.substr(d.indexOf("_")+1),url:d})}a.initProgress=!1}).error(function(){c.path("/shoes")}),a.newFile=function(c){a.progress=!0,b.post("/api/upload",c).success(function(b){a.progress=!1,c.url=b,a.images.push(c)}).error(function(){a.imagesError.code=3,a.imagesError.visible=!0,a.progress=!1})},a.closeImg=function(b){a.images.splice(b,1)},a.edit=function(){a.progress=!0;for(var d=[],e=0;e<a.images.length;e++)d.push(a.images[e].url);var f={reference:a.reference.toUpperCase(),brand:a.brand.toUpperCase(),category:a.category,size:a.size,color:a.color.color,price:a.price,quantity:a.quantity,season:a.season,maker:a.maker,provider:a.provider,location:a.location,keywords:a.keywords.split(",")||[],description:a.description,images:d};b.post("/api/shoes/edit/"+encodeURI(g),f).success(function(b){b?c.path("/shoes"):(a.imagesError.code=3,a.imagesError.visible=!0),a.progress=!1}).error(function(){a.imagesError.code=3,a.imagesError.visible=!0,a.progress=!1})},a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},a.submit=function(){var a=document.getElementById("shoes-edit-form");if(Event)a.dispatchEvent(new Event("submit"));else if(document.createEvent){var b=document.createEvent("HTMLEvents");b.initEvent("submit",!0,!1),a.dispatchEvent(b)}else if(document.createEventObject){var b=document.createEventObject();a.fireEvent("onSubmit",b)}}}]).controller("TicketsCtrl",["$scope","$http","$cookieStore","$window","$state","Colors","$modal","$stateParams","Printer",function(a,b,c,d,e,f,g,h,i){var j="";a.box=h.box||"",a.setOldTicket=function(b,c){a.oldTicketActived=c||!0,a.oldTicketInfo={code:b.overview.code,total:b.overview.total},a.ticketTax=b.overview.tax,a.ticketDiscount=b.overview.discount,a.ticketTotal=a.oldTicketInfo.total},a.hasPaid=function(){var b=parseFloat(a.ticketReceived.replace(",","."));return isNaN(b)&&(b=0),b>=a.ticketTotal},a.computeExchange=function(){if(a.hasPaid()){var b=parseFloat(a.ticketReceived.replace(",","."));isNaN(b)&&(b=0),a.ticketReturned=(b-a.ticketTotal).toFixed(2),0==a.ticketReturned&&(a.ticketReturned=0)}else a.ticketReturned=0},a.applySubRate=function(b){var c=a.products[b],d=c.discount.replace(",",".");if(isNaN(parseFloat(d))||parseFloat(d)<=0)return c.subtotal=c.price*c.quantity,a.applyRate();if(d.indexOf("%")>-1){var e=parseFloat(d.replace("%","")),f=c.price*c.quantity*e/100;c.subtotal=Math.round((c.price*c.quantity-f)*Math.pow(10,2))/Math.pow(10,2)}else c.subtotal=Math.round((c.price*c.quantity-parseFloat(d))*Math.pow(10,2))/Math.pow(10,2);return c.subtotal=c.subtotal<0?0:c.subtotal,a.applyRate()},a.applyRate=function(){for(var b=a.ticketTax-a.ticketDiscount,c=0,d=0;d<a.products.length;d++)c+=parseFloat(a.products[d].subtotal);"booked"==a.oldTicketActived&&(c+=a.oldTicketInfo.total);var e=c*b/100;if(a.ticketTotal=Math.round((e+c)*Math.pow(10,2))/Math.pow(10,2),"returned"==a.oldTicketActived&&(a.ticketTotal+=a.oldTicketInfo.total,0!=b)){var e=a.ticketTotal*b/100;a.ticketTotal=Math.round((e+a.ticketTotal)*Math.pow(10,2))/Math.pow(10,2)}a.ticketTotal=a.ticketTotal.toFixed(2),a.computeExchange()},a.addToTicket=function(c,d){if(!a.processingTicket)if(c){if(a.shoes.items[d].quantity<=0)return;for(var e=0;e<a.products.length;e++)if(a.products[e]._id==a.shoes.items[d]._id){var f={_id:a.products[e]._id,quantity:a.products[e].quantity+1,qa:a.products[e].quantity};return b.post("/api/ticket/update",{_id:a.ticketId,product:f}).success(function(){a.products[e].qa=a.products[e].quantity,a.products[e].quantity++,a.shoes.items[d].quantity--,a.products[e].shoe_qty--,a.applySubRate(e)}).error(function(){a.ticketNotice={visible:!0,code:3}})}var f={_id:a.shoes.items[d]._id,quantity:1,qa:0};b.post("/api/ticket/update",{_id:a.ticketId,product:f}).success(function(){a.shoes.items[d].quantity--,f.reference=a.shoes.items[d].reference,f.description=a.shoes.items[d].brand+", "+a.shoes.items[d].size+", "+a.shoes.items[d].color,f.price=a.shoes.items[d].price,f.discount="0",f.subtotal=a.shoes.items[d].price,f.type="s",f.shoe_qty=a.shoes.items[d].quantity,a.products.push(f),a.applyRate()}).error(function(){a.ticketNotice={visible:!0,code:3}})}else{var g=a.complements.brand?a.complements.brand:"";"object"==typeof a.complements.color&&(g+=""==g?a.complements.color.color:", "+a.complements.color.color);for(var e=0;e<a.products.length;e++)if(a.products[e].reference==a.complements.reference&&a.products[e].description==g&&a.products[e].price==a.complements.price)return a.products[e].quantity+=a.complements.quantity,a.applySubRate(e),void 0;a.products.push({reference:a.complements.reference,description:g,quantity:a.complements.quantity,price:a.complements.price,discount:"0",subtotal:a.complements.quantity*a.complements.price,type:"c"}),a.applyRate()}};var k=[];localStorage.boxes=localStorage.boxes?parseInt(localStorage.boxes)+1:1,d.onbeforeunload=function(){if(a.ticketId){k=(localStorage.sessTickets||"").split(",");var c=k.indexOf(a.ticketId);c>-1&&(k.splice(c,1),localStorage.sessTickets=k.join(","),localStorage.boxes>1&&b.post("/api/ticket/new",{session:k}).success(function(){}))}var d=parseInt(localStorage.boxes);d&&(localStorage.boxes=d-1)},a.$on("removeTicketId",function(){if(a.ticketId){k=(localStorage.sessTickets||"").split(",");var c=k.indexOf(a.ticketId);c>-1&&(k.splice(c,1),localStorage.sessTickets=k.join(","),localStorage.boxes>1&&b.post("/api/ticket/new",{session:k}).success(function(){}))}var d=parseInt(localStorage.boxes);d&&(localStorage.boxes=d-1)}),a.newTicket=function(c){if(a.progress=!0,a.products=[],a.ticketNotice={visible:!1,code:0},a.ticketTotal=0,a.ticketReceived="0",a.ticketReturned=0,a.ticketTax=0,a.ticketDiscount=0,a.changingQty=!1,a.ticketPM="cash",a.processingTicket=!1,a.shoes.reset(),a.complements.reset(),a.tickets.reset(),a.oldTicketActived=!1,a.oldTicketInfo=null,j="",a.payment_method.reset(),localStorage.sessTickets&&(k=localStorage.sessTickets.split(",")),a.ticketId){var d=k.indexOf(a.ticketId);d>-1&&(k.splice(d,1),localStorage.sessTickets=k.join(","))}b.post("/api/ticket/new",{session:k}).success(function(d){a.ticketId=d._id,j=d.code,a.shoes.references.length||a.shoes.brands.length||a.tickets.codes.length||a.tickets.employees.length?(k.push(a.ticketId),localStorage.sessTickets=k.join(","),c?c():a.progress=!1):b.post("/api/ticket/getFields").success(function(b){a.shoes.references=b.references||[],a.shoes.brands=b.brands||[],a.tickets.codes=b.codes||[],a.tickets.employees=b.employees||[],k.push(a.ticketId),localStorage.sessTickets=k.join(","),c?c():a.progress=!1})}).error(function(){console.log("error"),setTimeout(function(){a.newTicket()},1e3)})},a.removeFromTicket=function(c,d){if(!a.processingTicket){if(!d)return a.products.splice(c,1),a.products.length?(a.applyRate(),void 0):a.oldTicketActived?(a.ticketTotal=a.oldTicketInfo.total,a.computeExchange()):a.newTicket();var e={_id:a.products[c]._id,quantity:0,qa:a.products[c].quantity};b.post("/api/ticket/update",{_id:a.ticketId,product:e}).success(function(){a.products.splice(c,1);for(var b=0;b<a.shoes.items.length;b++)a.shoes.items[b]._id==e._id&&(a.shoes.items[b].quantity+=e.qa);return a.products.length?(a.applyRate(),void 0):a.oldTicketActived?(a.ticketTotal=a.oldTicketInfo.total,a.computeExchange()):a.newTicket()}).error(function(){a.ticketNotice={visible:!0,code:3}})}},a.incQty=function(c,d){if(!a.processingTicket){if(!d){var e=a.products[c];return e.quantity++,a.applySubRate(c),void 0}a.changingQty=!0;var f={_id:a.products[c]._id,quantity:a.products[c].quantity+1,qa:a.products[c].quantity};b.post("/api/ticket/update",{_id:a.ticketId,product:f}).success(function(){for(var b=0;b<a.shoes.items.length;b++)a.shoes.items[b]._id==f._id&&a.shoes.items[b].quantity--;var d=a.products[c];d.qa=d.quantity,d.quantity++,d.shoe_qty--,a.applySubRate(c),a.changingQty=!1}).error(function(){a.ticketNotice={visible:!0,code:3},a.changingQty=!1})}},a.decQty=function(c,d){if(!a.processingTicket){if(!d){var e=a.products[c];return e.quantity--,a.applySubRate(c),void 0}if(a.products[c].quantity>1){a.changingQty=!0;var f={_id:a.products[c]._id,quantity:a.products[c].quantity-1,qa:a.products[c].quantity};b.post("/api/ticket/update",{_id:a.ticketId,product:f}).success(function(){for(var b=0;b<a.shoes.items.length;b++)a.shoes.items[b]._id==f._id&&a.shoes.items[b].quantity++;var d=a.products[c];d.qa=d.quantity,d.quantity--,d.shoe_qty++,a.applySubRate(c),a.changingQty=!1}).error(function(){a.ticketNotice={visible:!0,code:3},a.changingQty=!1})}}},a.finishTicket=function(c,d,f){f=f||a.products,a.processingTicket=!0,a.ticketNotice.visible=!1;var h={total:a.ticketTotal,payment_method:a.ticketPM,returned:a.ticketReturned,received:a.ticketReceived,discount:a.ticketDiscount,tax:a.ticketTax,code:j};if("combined"==a.ticketPM&&(h.combined_cash=a.payment_method.combined_cash,h.combined_credit=a.payment_method.combined_credit,h.combined_voucher=a.payment_method.combined_voucher),parseInt(a.ticketDiscount)>0){var k=a.ticketTotal*a.ticketDiscount/100;h.total_discount=(Math.round((parseFloat(a.ticketTotal)-k)*Math.pow(10,2))/Math.pow(10,2)).toFixed(2)}a.oldTicketActived&&(h.update_code=a.oldTicketInfo.code),b.post("/api/ticket/"+c,{_id:a.ticketId,overview:h,products:f}).success(function(b){if(a.tickets.codes.push(j),!d)return i.print({cut:!0,content:b,openCashDrawer:!0},function(a){a&&console.log("printer not detected!")}),a.newTicket();var c=g.open({templateUrl:"ModalPrintTicket.html",controller:"ModalPrintTicketCtrl",backdrop:"static",keyboard:!1,resolve:{ticket:function(){return b}}});c.result.then(function(){return a.oldTicketActived?a.newTicket(function(){a.progress=!1,""!=a.box?e.go("tickets",{box:a.box}):e.go("tickets")}):(a.newTicket(),void 0)}),a.processingTicket=!1}).error(function(){a.ticketNotice={visible:!0,code:1},a.processingTicket=!1})},a.shoes={barcode:"",reference:"",brand:"",size:"",color:"",category:""},a.shoes.thPosition="up",a.shoes.items=[],a.shoes.searching={},a.shoes.references=[],a.shoes.brands=[],a.shoes.order={_id:-1},a.shoes.pagination={totalItems:0,maxSize:5,itemsPerPage:4,setPage:function(b){a.shoes.pagination.currentPage=b;for(var c=0,d=a.shoes.pagination.itemsPerPage,e=1;b>e;e++,c+=d);a.shoes.pagination.getItems(c,d)},getItems:function(c,d){b.post("/api/shoes",{search:a.shoes.searching,order:a.shoes.order,offset:c,limit:d}).success(function(b){a.shoes.pagination.totalItems=b.count,a.shoes.items=b.items,a.shoes.pagination.pages=Math.ceil(b.count/4)})},search:function(){""==a.shoes.barcode&&""==a.shoes.reference&&""==a.shoes.brand&&""==a.shoes.size&&""==a.shoes.category&&""==a.shoes.color?(a.shoes.items=[],a.shoes.pagination.pages=0,a.shoes.pagination.totalItems=0):(a.shoes.searching={},a.shoes.barcode&&(a.shoes.searching.barcode=a.shoes.barcode),a.shoes.reference&&(a.shoes.searching.reference=a.shoes.reference),a.shoes.brand&&(a.shoes.searching.brand=a.shoes.brand),a.shoes.size&&(a.shoes.searching.size=a.shoes.size),a.shoes.category&&(a.shoes.searching.category=a.shoes.category),a.shoes.color&&(a.shoes.searching.color="object"==typeof a.shoes.color?a.shoes.color.color:a.shoes.color),a.shoes.pagination.setPage(1))}},a.shoes.reset=function(){a.shoes.barcode="",a.shoes.reference="",a.shoes.brand="",a.shoes.size="",a.shoes.color="",a.shoes.category="",a.shoes.items=[],a.shoes.pagination.pages=0,a.shoes.pagination.totalItems=0},a.complements={},a.complements.references=["BOLSOS","CINTURONES","BISUTERIA","TOCADOS","MONEDEROS","PAÑUELOS"],a.complements.reset=function(){a.complements.reference="",a.complements.brand="",a.complements.color="",a.complements.price="",a.complements.quantity=""},a.colors=f.colorList,a.getColorCode=f.getColorCode,a.tickets={code:"",state:"",date:"",employee:""},a.tickets.items=[],a.tickets.searching={},a.tickets.codes=[],a.tickets.employees=[],a.tickets.states=["VENDIDO","RESERVADO"],a.tickets.order={_id:-1},a.tickets.pagination={totalItems:0,maxSize:5,itemsPerPage:4,setPage:function(b){a.tickets.pagination.currentPage=b;for(var c=0,d=a.tickets.pagination.itemsPerPage,e=1;b>e;e++,c+=d);a.tickets.pagination.getItems(c,d)},getItems:function(c,d){b.post("/api/tickets/get",{search:a.tickets.searching,order:a.tickets.order,offset:c,limit:d}).success(function(b){a.tickets.items=b.items,a.tickets.pagination.totalItems=b.count,a.tickets.pagination.pages=Math.ceil(b.count/4)}).error(function(){a.tickets.items=[],a.tickets.pagination.totalItems=0,a.tickets.pagination.pages=0})},search:function(){""==a.tickets.code&&""==a.tickets.employee&&""==a.tickets.date&&""==a.tickets.state?(a.tickets.items=[],a.tickets.pagination.pages=0,a.tickets.pagination.totalItems=0):(a.tickets.searching={},a.tickets.code&&(a.tickets.searching.code=a.tickets.code),a.tickets.state&&(a.tickets.searching.status=a.tickets.state),a.tickets.employee&&(a.tickets.searching.employee=a.tickets.employee),a.tickets.date&&(a.tickets.searching.date=a.tickets.date),a.tickets.pagination.setPage(1))
}},a.tickets.reset=function(){a.tickets.code="",a.tickets.state="",a.tickets.date="",a.tickets.employee="",a.tickets.items=[],a.tickets.pagination.pages=0,a.tickets.pagination.totalItems=0},a.tickets.setToday=function(){a.tickets.date=(new Date).toLocaleDateString(),a.tickets.pagination.search()},a.tickets.parseDate=function(a){return new Date(a).toLocaleDateString()};var l;a.tickets.abortTicket=function(c,d){d&&(a.tickets.items[d].disabled=!0),a.ticketNotice={visible:!1,code:0},l?b.post("/api/ticket/abort",l).success(function(b){return b.error?(l.loop_index=b.error,l.updated=b.updated||!1,d&&(a.tickets.items[d].disabled=!1),a.ticketNotice={visible:!0,code:1},void 0):e.current.name.indexOf("reserve")>-1?(l=null,a.newTicket(function(){a.progress=!1,""!=a.box?e.go("tickets",{box:a.box}):e.go("tickets")})):(a.tickets.items.splice(d,1),a.tickets.pagination.totalItems--,a.tickets.pagination.pages=Math.ceil(a.tickets.pagination.totalItems/4),l=null,void 0)}).error(function(){d&&(a.tickets.items[d].disabled=!1),a.ticketNotice={visible:!0,code:1}}):b.post("/api/ticket/get/sessionTicket",{code:c}).success(function(c){l={loop_index:0,products:c.ticket.products,_id:c.sessTicket._id,overview:c.ticket.overview,updated:!1},b.post("/api/ticket/abort",l).success(function(b){return b.error?(l.loop_index=b.error,l.updated=b.updated||!1,d&&(a.tickets.items[d].disabled=!1),a.ticketNotice={visible:!0,code:1},void 0):e.current.name.indexOf("reserve")>-1?(l=null,a.newTicket(function(){a.progress=!1,""!=a.box?e.go("tickets",{box:a.box}):e.go("tickets")})):(a.tickets.items.splice(d,1),a.tickets.pagination.totalItems--,a.tickets.pagination.pages=Math.ceil(a.tickets.pagination.totalItems/4),l=null,void 0)}).error(function(){d&&(a.tickets.items[d].disabled=!1),a.ticketNotice={visible:!0,code:1}})}).error(function(){d&&(a.tickets.items[d].disabled=!1),a.ticketNotice={visible:!0,code:1}})},a.tickets.reprintTicket=function(b){i.print({cut:!0,content:a.tickets.items[b].print,openCashDrawer:!1},function(a){a?console.log("printer not detected!"):console.log("printer detected: "+i.getName())})},a.$on("usernameChanged",function(b,c){var d=a.tickets.employees.indexOf(c.before);d>-1&&a.tickets.employees.splice(d,1),a.tickets.employees.push(c.current)}),a.box={date:"",initialCash:"",progress:!1,result:[],total:0,total_stack:0},a.box.makeBox=function(){a.box.progress=!0;var c={};c.date=a.box.date?a.box.date:(new Date).toLocaleDateString(),console.log(c),b.post("/api/box/get",c).success(function(b){if(a.box.progress=!1,!b.box.length)return a.box.result=[],a.box.total=0,void 0;for(var c=0;c<b.box.length;c++)b.box[c].total_cash=b.box[c].total_cash.toFixed(2),b.box[c].total_credit=b.box[c].total_credit.toFixed(2),b.box[c].total_rcash=b.box[c].total_rcash.toFixed(2),b.box[c].total=b.box[c].total.toFixed(2),b.box[c].total_box=(parseFloat(b.box[c].total_cash)+parseFloat(b.box[c].total_rcash)).toFixed(2);a.box.result=b.box,a.box.total=b.total.toFixed(2)}).error(function(){a.box.progress=!1})},a.box.applyInitCash=function(){a.box.total-=a.box.total_stack,a.box.total_stack=a.box.initialCash,a.box.total+=a.box.initialCash},a.box.printToPDF=function(){var a=window.open("","Imprimir Resumen Caja","height=400,width=600");a.document.write("<html><head>"),a.document.write("</head><body >"),a.document.write(document.getElementById("tickets_box_summary").outerHTML),a.document.write("</body></html>"),a.document.close(),a.print()},a.box.printToTicket=function(){for(var b="\r\n\r\nTICKET RESUMEN DE CAJA CON FECHA: "+(new Date).toLocaleDateString()+"\r\nHORA: "+(new Date).toLocaleTimeString()+"\r\n\r\n",c=a.box.result.length-1,d=0;c>d;d++)b+="Emplead@: "+a.box.result[d].employee+" | Ventas: "+a.box.result[d].ordered+"\r\n",b+="Devoluciones(Vales): "+a.box.result[d].returned_voucher+" | Devoluciones(Efectivo): "+a.box.result[d].returned_cash+"\r\n",b+="Devoluciones Sin Emision: "+a.box.result[d].returned_plus_ordered+" | Efectivo Devuelto: "+a.box.result[d].total_rcash+" Euros\r\n",b+="Reservas: "+a.box.result[d].booked+" | Anulaciones: "+a.box.result[d].cancelled+"\r\n",b+="Total Efectivo: "+a.box.result[d].total_cash+" Euros | Total T. Cred.: "+a.box.result[d].total_credit+" Euros\r\n",b+="Total Tickets: "+a.box.result[d].total_tickets+" | Total: "+a.box.result[d].total+" Euros\r\n",b+="Caja: "+(a.box.result[d].total_cash+a.box.result[d].total_rcash)+" Euros | Caja FINAL: "+(a.box.result[d].total_cash+a.box.result[d].total_rcash+a.box.initialCash)+" Euros\r\n\r\n";return b+="------------------------------------------\r\n\r\n",b+="Total Tickets: "+a.box.result[c].total_tickets+" | Ventas: "+a.box.result[c].ordered+"\r\n",b+="Devoluciones(Vales): "+a.box.result[c].returned_voucher+" | Devoluciones(Efectivo): "+a.box.result[c].returned_cash+"\r\n",b+="Devoluciones Sin Emision: "+a.box.result[c].returned_plus_ordered+" | Efectivo Devuelto: "+a.box.result[c].total_rcash+" Euros\r\n",b+="Reservas: "+a.box.result[c].booked+" | Anulaciones: "+a.box.result[c].cancelled+"\r\n",b+="Total Efectivo: "+a.box.result[c].total_cash+" Euros | Total T. Cred.: "+a.box.result[c].total_credit+" Euros\r\n",b+="Total: "+a.box.result[c].total+" Euros | Total + Deposito Inicial: "+(a.box.result[c].total+a.box.initialCash)+" Euros\r\n",b+="Caja: "+(a.box.result[c].total_cash+a.box.result[c].total_rcash)+" Euros | Caja FINAL: "+(a.box.result[c].total_cash+a.box.result[c].total_rcash+a.box.initialCash)+" Euros\r\n\r\n",b+="------------------------------------------\r\n\r\n",b+="-   -   -   -   -   -   -   -   -   -   -\r\n\r\n\r\n",i.print({cut:!0,content:b,openCashDrawer:!0},function(a){a?console.log("printer not detected!",a):console.log("printer detected",a)})},a.box.reset=function(){a.box.dateFrom="",a.box.dateTo="",a.box.initialCash="",a.box.progress=!1,a.box.result=[],a.box.total=0,a.box.total_stack=0},a.payment_method={},a.payment_method.reset=function(b){return"voucher"==b&&a.ticketTotal>0?(a.payment_method.voucher=!0,a.payment_method.combined=!1,void 0):"combined"==b&&a.ticketTotal>0?(a.payment_method.combined=!0,a.payment_method.voucher=!1,a.payment_method.combined_cash=0,a.payment_method.combined_credit=0,a.payment_method.combined_voucher=0,a.payment_method.compute_combined(),void 0):(a.payment_method.voucher_code="",a.payment_method.voucher_code_error=!1,a.payment_method.voucher=!1,a.payment_method.combined=!1,void 0)},a.payment_method.validate=function(){a.payment_method.voucher_code_error=!1,""!=a.payment_method.voucher_code&&b.post("/api/ticket/voucher/validate",{code:a.payment_method.voucher_code}).success(function(b){b?(a.ticketReceived=b.total.toString(),a.payment_method.voucher_code="",a.payment_method.voucher=!1,b.total<a.ticketTotal&&(a.payment_method.combined=!0,a.ticketPM="combined",a.payment_method.combined_voucher=b.total,a.payment_method.compute_combined()),a.computeExchange()):a.payment_method.voucher_code_error=!0}).error(function(){a.payment_method.voucher_code_error=!0})},a.payment_method.combined_needed=0,a.payment_method.compute_combined=function(){var b=(a.payment_method.combined_cash||0)+(a.payment_method.combined_credit||0)+(a.payment_method.combined_voucher||0);a.ticketReceived=b.toString(),a.computeExchange(),a.payment_method.combined_needed=(a.ticketTotal-b).toFixed(2)},-1==e.current.name.indexOf("return")&&-1==e.current.name.indexOf("reserve")&&a.newTicket()}]).controller("ModalPrintTicketCtrl",["$scope","$modalInstance","ticket","Printer",function(a,b,c,d){a.ticket=c,a.print=function(){d.print({content:a.ticket,cut:!0,openCashDrawer:!0},function(b){b&&(console.log("no printer detected!: to normal printing"),a.no_printer())})},a.ok=function(){b.close()},a.no_printer=function(){var b=window.open("","Imprimir Ticket","height=400,width=600");b.document.write("<html><head>"),b.document.write("</head><body ><pre>"),b.document.write(a.ticket),b.document.write("<pre/></body></html>"),b.document.close(),b.print()}}]).controller("TicketsReturnCtrl",["$scope","$stateParams","$http","$state",function(a,b,c,d){var e;if(a.code=b.code,!a.code)return d.go("error");a.newTicket(function(){c.post("/api/ticket/getByCode",{code:a.code}).success(function(b){a.returnTicketTotal=b.overview.total,a.returnTicketTax=b.overview.tax,a.returnTicketDiscount=b.overview.discount,a.returnProducts=b.products,e=b.date_end;for(var c=0;c<a.returnProducts.length;c++)a.returnProducts[c].totalQuantity=a.returnProducts[c].quantity,a.returnProducts[c].returned=!1,a.returnProducts[c]._discount=parseFloat(a.returnProducts[c].discount)/a.returnProducts[c].quantity;b.overview.total=0,a.$parent.setOldTicket(b,"returned"),a.$parent.ticketDiscount=a.returnTicketDiscount,a.$parent.progress=!1,console.log(a.returnProducts)})});var f=function(b){var c=a.returnProducts[b].quantity,d=a.returnProducts[b].price,e=a.returnProducts[b].discount,f=d*c;return e=-1!=e.indexOf("%")?parseFloat(e)/100*d*c:c*a.returnProducts[b]._discount,f-=e};a.returnItem=function(b){var d,e;return a.returnProducts[b].returned?(e={_id:a.returnProducts[b]._id,quantity:0,qa:-a.returnProducts[b].quantity},d=f(b)):(e={_id:a.returnProducts[b]._id,quantity:-a.returnProducts[b].quantity,qa:0},d=-f(b)),"c"==a.returnProducts[b].type?(a.$parent.oldTicketInfo.total+=d,a.$parent.applyRate(),void 0):(c.post("/api/ticket/update",{_id:a.ticketId,product:e}).success(function(){a.$parent.oldTicketInfo.total+=d,a.$parent.applyRate();for(var b=0;b<a.shoes.items.length;b++)a.shoes.items[b]._id==e._id&&(a.shoes.items[b].quantity+=e.qa-e.quantity)}).error(function(){a.ticketNotice={visible:!0,code:3}}),void 0)},a.decReturnQty=function(b){var d;return a.returnProducts[b].returned?(d={_id:a.returnProducts[b]._id,quantity:-(a.returnProducts[b].quantity-1),qa:-a.returnProducts[b].quantity},"c"==a.returnProducts[b].type?(a.$parent.oldTicketInfo.total+=f(b),a.returnProducts[b].quantity--,a.$parent.oldTicketInfo.total+=-f(b),a.$parent.applyRate(),a.returnProducts[b].returned=!0,a.returnProducts[b].subtotal=Math.abs(a.$parent.oldTicketInfo.total).toFixed(2),void 0):c.post("/api/ticket/update",{_id:a.ticketId,product:d}).success(function(){a.$parent.oldTicketInfo.total+=f(b),a.returnProducts[b].quantity--,a.$parent.oldTicketInfo.total+=-f(b),a.$parent.applyRate(),a.returnProducts[b].returned=!0,a.returnProducts[b].subtotal=Math.abs(a.$parent.oldTicketInfo.total).toFixed(2);for(var c=0;c<a.shoes.items.length;c++)a.shoes.items[c]._id==d._id&&(a.shoes.items[c].quantity+=d.qa-d.quantity)}).error(function(){a.ticketNotice={visible:!0,code:3}})):(d={_id:a.returnProducts[b]._id,quantity:-(a.returnProducts[b].quantity-1),qa:0},"c"==a.returnProducts[b].type?(a.returnProducts[b].quantity--,a.$parent.oldTicketInfo.total+=-f(b),a.$parent.applyRate(),a.returnProducts[b].returned=!0,a.returnProducts[b].subtotal=Math.abs(a.$parent.oldTicketInfo.total).toFixed(2),void 0):c.post("/api/ticket/update",{_id:a.ticketId,product:d}).success(function(){a.returnProducts[b].quantity--,a.$parent.oldTicketInfo.total+=-f(b),a.$parent.applyRate(),a.returnProducts[b].returned=!0,a.returnProducts[b].subtotal=Math.abs(a.$parent.oldTicketInfo.total).toFixed(2);for(var c=0;c<a.shoes.items.length;c++)a.shoes.items[c]._id==d._id&&(a.shoes.items[c].quantity+=d.qa-d.quantity)}).error(function(){a.ticketNotice={visible:!0,code:3}}))},a.incReturnQty=function(b){var d;return a.returnProducts[b].returned?(d={_id:a.returnProducts[b]._id,quantity:-(a.returnProducts[b].quantity+1),qa:-a.returnProducts[b].quantity},"c"==a.returnProducts[b].type?(a.$parent.oldTicketInfo.total+=f(b),a.returnProducts[b].quantity++,a.$parent.oldTicketInfo.total+=-f(b),a.$parent.applyRate(),a.returnProducts[b].returned=!0,a.returnProducts[b].subtotal=Math.abs(a.$parent.oldTicketInfo.total).toFixed(2),void 0):c.post("/api/ticket/update",{_id:a.ticketId,product:d}).success(function(){a.$parent.oldTicketInfo.total+=f(b),a.returnProducts[b].quantity++,a.$parent.oldTicketInfo.total+=-f(b),a.$parent.applyRate(),a.returnProducts[b].returned=!0,a.returnProducts[b].subtotal=Math.abs(a.$parent.oldTicketInfo.total).toFixed(2);for(var c=0;c<a.shoes.items.length;c++)a.shoes.items[c]._id==d._id&&(a.shoes.items[c].quantity+=d.qa-d.quantity)}).error(function(){a.ticketNotice={visible:!0,code:3}})):(d={_id:a.returnProducts[b]._id,quantity:-(a.returnProducts[b].quantity+1),qa:0},"c"==a.returnProducts[b].type?(a.returnProducts[b].quantity++,a.$parent.oldTicketInfo.total+=-f(b),a.$parent.applyRate(),a.returnProducts[b].returned=!0,a.returnProducts[b].subtotal=Math.abs(a.$parent.oldTicketInfo.total).toFixed(2),void 0):c.post("/api/ticket/update",{_id:a.ticketId,product:d}).success(function(){a.returnProducts[b].quantity++,a.$parent.oldTicketInfo.total+=-f(b),a.$parent.applyRate(),a.returnProducts[b].returned=!0,a.returnProducts[b].subtotal=Math.abs(a.$parent.oldTicketInfo.total).toFixed(2);for(var c=0;c<a.shoes.items.length;c++)a.shoes.items[c]._id==d._id&&(a.shoes.items[c].quantity+=d.qa-d.quantity)}).error(function(){a.ticketNotice={visible:!0,code:3}}))},a.cancel=function(){a.newTicket(function(){a.$parent.progress=!1,""!=a.box?d.go("tickets",{box:a.box}):d.go("tickets")})},a.returnTicket=function(){var b={};b.date=e,b["new"]=a.products,b.retained=[],b.returned=[];for(var c={},d=0;d<a.returnProducts.length;d++)a.returnProducts[d].returned?a.returnProducts[d].quantity==a.returnProducts[d].totalQuantity?b.returned.push(a.returnProducts[d]):(angular.extend(c,a.returnProducts[d]),c.quantity=a.returnProducts[d].totalQuantity-a.returnProducts[d].quantity,c.returned=!1,c.subtotal=(c.quantity*a.returnProducts[d].price).toFixed(2),b.returned.push(a.returnProducts[d]),b.retained.push(c)):b.retained.push(a.returnProducts[d]),c={};var f=[];if(b["new"].length&&b.retained.length){for(var g={},h=0;h<b["new"].length;h++)angular.extend(g,b["new"][h]),f.push(g),g={};for(var i=!1,j=0;j<b.retained.length;j++){i=!1;for(var k=0;k<f.length;k++)b.retained[j]._id==f[k]._id&&(i=k);i!==!1?(f[i].quantity+=b.retained[j].quantity,f[i].subtotal=(parseFloat(f[i].subtotal)+parseFloat(b.retained[j].subtotal)).toFixed(2)):f.push(b.retained[j])}}else f=b["new"].concat(b.retained);return b.productsFinal=f,a.finishTicket("return",!0,b)}}]).controller("TicketsReserveCtrl",["$scope","$stateParams","$http","$state",function(a,b,c,d){return a.code=b.code,a.code?(a.newTicket(function(){c.post("/api/ticket/getByCode",{code:a.code}).success(function(b){a.savedTicketTotal=b.overview.total,a.savedTicketTax=b.overview.tax,a.savedTicketDiscount=b.overview.discount,a.savedProducts=b.products,a.$parent.setOldTicket(b,"booked"),a.$parent.progress=!1})}),a.cancel=function(){a.newTicket(function(){a.$parent.progress=!1,""!=a.box?d.go("tickets",{box:a.box}):d.go("tickets")})},a.totalAdjusted=function(){var b=a.savedTicketTotal*(a.$parent.ticketDiscount-a.$parent.ticketTax)/100;return Math.round((a.savedTicketTotal-b)*Math.pow(10,2))/Math.pow(10,2)},a.saveTicket=function(){for(var b=[],c=0;c<a.savedProducts.length;c++)b.push(a.savedProducts[c]);if(a.products.length)for(var d=!1,e=0;e<a.products.length;e++){for(var f=0;f<b.length;f++)if(b[f]._id==a.products[e]._id){d=f;break}d===!1?b.push(a.products[e]):(b[f].quantity+=a.products[e].quantity,b[f].subtotal=(parseFloat(a.products[e].subtotal)+parseFloat(b[f].subtotal)).toFixed(2)),d=!1}return a.finishTicket("order",!0,b)},void 0):d.go("error")}]),angular.module("kalzate.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("kalzate.directives",[]).directive("accessLevel",["Auth",function(a){return{restrict:"A",link:function(b,c,d){function e(){f&&g&&(a.authorize(g,f)?c.css("display","none"==h?"block":h):c.css("display","none"))}var f,g,h=c.css("display");b.user=a.user,b.$watch("user",function(a){a.role&&(f=a.role),e()},!0),g=a.accessLevels[d.accessLevel]}}}]).directive("activeNav",["$location",function(a){return{restrict:"A",link:function(b,c,d){var e=c.find("a")[0];if(e){var f=d.navSection;b.location=a,b.$watch("location.path()",function(a){a.indexOf(f)>-1?c.addClass("active"):c.removeClass("active")})}}}}]).directive("kzSubmit",["$parse",function(a){return{restrict:"A",require:["kzSubmit","?form"],controller:["$scope",function(){this.attempted=!1,this.setAttempted=function(){this.attempted=!0};var a=null;this.setFormController=function(b){a=b},this.needsAttention=function(b){return a?b?b.$invalid&&(b.$dirty||this.attempted):a&&a.$invalid&&(a.$dirty||this.attempted):!1}}],compile:function(){return{pre:function(a,b,c,d){var e=d[0],f=d.length>1?d[1]:null;e.setFormController(f),a.kz=a.kz||{},a.kz[c.name]=e},post:function(b,c,d,e){var f=e[0],g=e.length>1?e[1]:null,h=a(d.kzSubmit);c.bind("submit",function(a){return f.setAttempted(),b.$$phase||b.$apply(),g.$valid?(b.safeApply?b.safeApply(function(){h(b,{$event:a})}):b.$apply(function(){h(b,{$event:a})}),void 0):!1})}}}}}]).directive("fileDropzone",["$compile",function(a){return{replace:!1,terminal:!0,scope:{uploadFileText:"@",uploadFileTextClass:"@",fileError:"=",fileLoading:"=",onFileChange:"&onFileChange"},link:function(b,c,d){var e,f,g,h,i,j=c.html();if(d.fileInput){var k="filedropzone"+Math.random().toString(16);if(d.uploadFileWrapperClass){var l=d.uploadFileWrapperClass.split(".");j="<"+l[0]+' class="'+l[1]+'"><label class="{{uploadFileTextClass}}" for="'+k+'">{{uploadFileText}}</label><input id="'+k+'" type="file" style="display:none;"/></'+l[0]+">"+j,j=angular.element(j),c.children().remove(),c.append(j);var m=angular.element(angular.element(c.children()[0]).children()[0]),n=angular.element(angular.element(c.children()[0]).children()[1])}else{j='<label class="{{uploadFileTextClass}}" for="'+k+'">{{uploadFileText}}</label><input id="'+k+'" type="file" style="display:none;"/>'+j,j=angular.element(j),c.children().remove(),c.append(j);var m=angular.element(c.children()[0]),n=angular.element(c.children()[1])}var o=function(){n.unbind("click"),n.remove(),k="filedropzone"+Math.random().toString(16),n=angular.element(document.createElement("input")),n.attr("type","file"),n.attr("id",k),n.css("display","none"),n.bind("change",function(a){i(a,!0)}),m.after(n),m.attr("for",k)};n.bind("change",function(a){i(a,!0)})}else j='<label class="{{uploadFileTextClass}}">{{uploadFileText}}</label>'+j,j=angular.element(j),c.children().remove(),c.append(j);d.uploadFileText||(d.uploadFileText="ARRASTRA TUS FICHEROS AQUÍ"),d.uploadFileTextClass||(d.uploadFileTextClass="dropzone-label"),a(j)(b),g=function(a){return a&&a.preventDefault(),a.dataTransfer.effectAllowed="copy",!1},h=d.fileDropzone,e=function(a){var c;return void 0===(c=d.maxFileSize)||""===c||a/1024/1024<d.maxFileSize?!0:(b.$apply(function(){b.fileLoading=!1,b.fileError.code=1,b.fileError.visible=!0}),!1)},f=function(a){return""==a?!0:(void 0===h||""===h||!a||h.indexOf(a)>-1)&&""!=a.replace(/\ /g,"")?!0:(b.$apply(function(){b.fileLoading=!1,b.fileError.code=2,b.fileError.visible=!0}),!1)},i=function(a,c){b.fileLoading=!0;var g,h,i,j,k;return a&&a.preventDefault(),g=c?n[0].files[0]:a.dataTransfer.files[0],h=g.name,k=g.type,j=g.size,i=new FileReader,i.onload=function(a){if(e(j)&&f(k)){var d={};return d.data=a.target.result,d.name=h,d.size=j,d.type=k,c&&o(),b.$apply(function(){b.fileError.visible=!1,b.onFileChange({file:d}),b.fileLoading=!1})}},"text"==d.readFileAs?i.readAsText(g):i.readAsDataURL(g),!1};var p=c.parent().parent().parent().parent().parent();p.bind("drop",function(){event.preventDefault()}),p.bind("dragover",function(){event.preventDefault()}),p.bind("dragenter",function(){event.preventDefault()}),c.bind("dragover",g),c.bind("dragenter",g),c.bind("drop",function(a){i(a,!1)})}}}]).directive("jsonTable",[function(){return{restrict:"A",replace:!0,scope:{jsonTable:"@",jsonTableData:"=",jsonTableLoaded:"=",jsonTableActive:"="},link:function(a,b){var c=function(a){var b,c=function(a){var b=document.createElement("tr");return b.ID=a,b},d=function(a){var b=document.createElement("th");return b.className="text-center",b.innerHTML=a.charAt(0).toUpperCase()+a.slice(1).toLowerCase(),b},e=function(a){var b=document.createElement("td");return b.innerHTML=a,b},f=new Object;if(a.length>0){var g=0,h=document.createElement("thead"),i=document.createElement("tbody"),k=c();b=document.createElement("table"),b.className="table text-center",k.appendChild(d("Nº"));for(var l in a[0])f.hasOwnProperty(l)||(k.appendChild(d(l)),f[l]=g,g++);h.appendChild(k),b.appendChild(h);for(var m=0;m<a.length;m++){var n=new c(m);n.appendChild(e(m+1));for(j in a[m])n.appendChild(e(a[m][j]));i.appendChild(n)}b.appendChild(i)}return b};a.$watch("jsonTable",function(d){a.jsonTableActive&&(console.log("renderinf Table"),a.jsonTableLoaded=!0,b.append(c(a.jsonTableData[parseInt(d)].data)),a.jsonTableLoaded=!1)}),a.$watch("jsonTableActive",function(d){d&&(console.log("renderinf Active"),a.jsonTableLoaded=!0,b.append(c(a.jsonTableData[parseInt(a.jsonTable)].data)),a.jsonTableLoaded=!1)})}}}]).directive("imgLoad",[function(){return{scope:{imgLoad:"=",imgLoadError:"&imgLoadError",imgLoadSuccess:"&imgLoadSuccess"},link:function(a,b){var c=0;b.bind("error",function(){a.$apply(function(){a.imgLoadError({index:c})}),c++}),b.bind("load",function(){b.unbind("load"),b.unbind("error"),a.$apply(function(){a.imgLoadSuccess()})}),a.$watch("imgLoad",function(a){b.attr("src",a)})}}}]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]),angular.module("kalzate").run(["$templateCache",function(a){a.put("/static/partials/404.html","<p>Página no encontrada</p>"),a.put("/static/partials/home.html","<div style=width:248px;margin:auto;height:204px;position:absolute;top:50%;left:50%;margin-top:-102px;margin-left:-124px><img src=/static/img/construction.png></div>"),a.put("/static/partials/login.html",'<div id=signin class=container ng-controller=LoginCtrl><div class="panel panel-default panel-signin"><div class=panel-body><form kz-submit=login() name=loginForm novalidate><h2 class=form-signin-heading>¡Inicia Sesión!</h2><div ng-class="{\'has-error\': kz.loginForm.needsAttention(loginForm.username)}"><input type=email placeholder=Emplead@ class=form-control ng-model=username name=username typeahead="item for item in [\'ana.de.la.rosa.villalobos@gmail.com\',\'canciondiferente@hotmail.com\'] | filter:$viewValue | limitTo:1" autocomplete=off required></div><div ng-class="{\'has-error\': kz.loginForm.needsAttention(loginForm.password)}"><input type=password placeholder=Contraseña class=form-control pattern=.{8,} ng-model=password name=password ng-minlength=8 required></div><input type=submit class="btn btn-lg btn-primary btn-block" value=Acceder><small class=text-primary><a ui-sref=recover>¿Has olvidado tu contraseña?</a> | <a ui-sref=register>Crea una cuenta</a></small></form><div ng-show=error class="alert alert-danger"><p class=text-center><strong>Hmmm...¡No te conozco!</strong></p></div></div></div></div>'),a.put("/static/partials/recover.html",'<div id=signin class=container><div class="panel panel-default panel-signin"><div class=panel-body><form name=recoverForm kz-submit=recover() novalidate><h2 class=form-signin-heading>¡Recupera tu Contraseña!</h2><div style="margin:10px auto" ng-class="{\'has-error\': kz.recoverForm.needsAttention(recoverForm.email)}"><input type=email placeholder=Email class=form-control ng-model=email name=email required></div><input type=submit class="btn btn-lg btn-primary btn-block" value="Enviar Contraseña"></form><div ng-show=serverNotice.visible class="alert alert-danger" ng-switch=serverNotice.code><p class=text-center ng-switch-when=0><strong>¡Hemos enviado una nueva contraseña a su correo electrónico! Pulsa <a ui-sref=login>aquí</a> para ingresar al sistema</strong></p><p class=text-center ng-switch-when=1><strong>¡Esta cuenta no existe!</strong></p></div></div></div></div>'),a.put("/static/partials/register.html",'<div id=signin class=container ng-controller=RegisterCtrl><div class="panel panel-default panel-signin"><div class=panel-body><form name=registerForm kz-submit=register() novalidate><h2 class=form-signin-heading>¡Crea una Cuenta!</h2><div ng-class="{\'has-error\': kz.registerForm.needsAttention(registerForm.email)}"><input type=email placeholder=Email class=form-control ng-model=email name=email required></div><div ng-class="{\'has-error\': kz.registerForm.needsAttention(registerForm.password)}"><input type=password placeholder=Contraseña class=form-control pattern=.{8,} ng-model=password name=password ng-minlength=8 required></div><div class=form-group><input placeholder="Nombre Usuario" class=form-control ng-model=username name=username></div><input type=submit class="btn btn-lg btn-primary btn-block" value=Acceder></form><div ng-show=serverError class="alert alert-danger"><p class=text-center><strong>¡Esta cuenta ya existe! Pulsa <a ui-sref=recover>aquí</a> si olvidaste tu contraseña</strong></p></div></div></div></div>'),a.put("/static/partials/shoe_edit.html",'<div class=container><div class="panel panel-default panel-custom"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Modificar Zapato</h3><div class="btn-group pull-right"><a ui-sref=shoes class="btn btn-default"><span class="glyphicon glyphicon-remove-circle"></span></a> <button data-ng-click=submit() class="btn btn-default"><span class="glyphicon glyphicon-ok-circle"></span></button></div></div><div class=panel-body><p ng-show=initProgress class=text-center>Espere por favor &hellip;</p><div ng-show=initProgress class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div><form kz-submit=edit() id=shoes-edit-form class=shoes-form name=shoeEditForm ng-show=!initProgress novalidate><div ng-switch=imagesError.code ng-show=imagesError.visible class="alert alert-danger"><p ng-switch-when=1 class=text-center>La foto tiene más de 3 MBytes</p><p ng-switch-when=2 class=text-center>El fichero está corrupto o no tiene un formato de imagen válido (png, jpeg o gif)</p><p ng-switch-when=3 class=text-center>No hemos podido guardar la foto</p><p ng-switch-default="" class=text-center>{{imagesError.msg}}</p></div><div data-file-dropzone="[image/png, image/jpg, image/jpeg, image/gif]" data-max-file-size=2 data-on-file-change=newFile(file) data-file-input=true data-upload-file-text="ARRASTRA TUS FOTOS AQUÍ" data-file-error=imagesError data-file-loading=progress data-upload-file-wrapper-class=div.col-lg-12 data-read-file-as=data class="row first-row"><div class="col-sm-6 col-md-3" style=margin-top:20px ng-repeat="img in $parent.images"><a href=# class=thumbnail><img src={{img.data}} alt={{img.name}}></a><p class=text-center><span>{{img.name}}</span><span ng-click=$parent.$parent.closeImg($index) style=margin-left:10px;font-size:20px;cursor:pointer>&times;</span></p></div></div><div ng-show=progress class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div><div class=row><div class=col-lg-3><label>Referencia (*)</label><div ng-class="{\'has-error\': kz.shoeEditForm.needsAttention(shoeEditForm.reference)}"><input class=form-control ng-model=reference placeholder=Referencia name=reference ng-pattern=/^[0-9A-Za-z\\-\\_]{3,}$/ required></div><span class=help-block>Identificador único. Puede utilizar su lector de código de barras.</span></div><div class=col-lg-3><label>Marca (*)</label><div ng-class="{\'has-error\': kz.shoeEditForm.needsAttention(shoeEditForm.brand)}"><input class=form-control ng-model=brand placeholder=Modelo name=brand required></div><span class=help-block>El modelo de fábrica del producto</span></div><div class=col-lg-3><label>Precio (*)</label><div class=input-group ng-class="{\'has-error\': kz.shoeEditForm.needsAttention(shoeEditForm.price)}"><input type=number class=form-control placeholder=Precio min=0 ng-model=price name=price step=0.1 required></div><span class=help-block>Por defecto se utilizan euros.</span></div><div class=col-lg-3><label>Cantidad (*)</label><div ng-class="{\'has-error\': kz.shoeEditForm.needsAttention(shoeEditForm.quantity)}"><input type=number class=form-control placeholder=Cantidad min=1 ng-model=quantity name=quantity ng-minlength=1 required></div><span class=help-block>Indique el número de artículos que dispone para este producto</span></div></div><div class=row><div class=col-lg-3><label>Talla (*)</label><div ng-class="{\'has-error\': kz.shoeEditForm.needsAttention(shoeEditForm.size)}"><input type=number class=form-control ng-model=size name=size placeholder=Talla min=18 max=45 required></div><span class=help-block>Tamaño o talla del producto</span></div><div class=col-lg-3><label>Color (*)</label><div ng-class="{\'has-error\': kz.shoeEditForm.needsAttention(shoeEditForm.color)}"><input class=form-control ng-model=color name=color typeahead="item as item.color for item in colors | filter:$viewValue | limitTo:8" autocomplete=off typeahead-template-url=searchAutocompleteTpl.html placeholder=Color required></div><span class=help-block>El color del producto</span></div><div class=col-lg-3><label>Categoría</label><div><select class=form-control data-ng-model=category ng-options="v for v in [\'HOMBRES\',\'MUJERES\',\'NIÑOS\']"></select></div><span class=help-block>Grupo o categoría a la que pertence el producto</span></div><div class=col-lg-3><label>Temporada</label><div><select class=form-control data-ng-model=season ng-options="v for v in [\'VERANO\',\'INVIERNO\']"></select></div><span class=help-block>Indique si pertenece a la temporada verano o invierno</span></div></div><div class=row><div class=col-lg-3><label>Fabricante</label><input class=form-control data-ng-model=maker placeholder=Fabricante><span class=help-block>Fabricante del producto</span></div><div class=col-lg-3><label>Proveedor</label><input class=form-control ng-model=provider placeholder=Proveedor><span class=help-block>Proveedor del producto</span></div><div class=col-lg-3><label>Palabras Clave</label><input class=form-control ng-model=keywords placeholder=Keywords><span class=help-block>Indique palabras separadas por coma que hagan referencia al producto. Ej: piel, seminuevo, ganga</span></div><div class=col-lg-3><label>Ubicación</label><input class=form-control ng-model=location placeholder=Ubicación><span class=help-block>Indique el número de la estantería dentro del almacen donde se localiza el producto</span></div></div><div class=row><div class=col-lg-6><label>Descripción</label><textarea class=form-control ng-model=description rows=3></textarea><span class=help-block>Descripción del producto</span></div><div class=col-lg-6><label>Comentarios</label><textarea class=form-control ng-model=comments rows=3></textarea><span class=help-block>Comentarios del producto</span></div></div></form></div><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Modificar Zapato</h3><div class="btn-group pull-right"><a ui-sref=shoes class="btn btn-default"><span class="glyphicon glyphicon-remove-circle"></span></a> <button data-ng-click=create() class="btn btn-default"><span class="glyphicon glyphicon-ok-circle"></span></button></div></div></div></div>'),a.put("/static/partials/shoe_new.html",'<div class=container><div class="panel panel-default panel-custom"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Añadir Nuevo Zapato</h3><div class="btn-group pull-right"><a ui-sref=shoes class="btn btn-default"><span class="glyphicon glyphicon-remove-circle"></span></a> <button data-ng-click=submit() class="btn btn-default"><span class="glyphicon glyphicon-ok-circle"></span></button></div></div><div class=panel-body><form kz-submit=create() id=stock-add-form class=shoes-form name=shoeAddForm novalidate><div ng-switch=imagesError.code ng-show=imagesError.visible class="alert alert-danger" style="margin: 30px"><p ng-switch-when=1 class=text-center>La foto tiene más de 3 MBytes</p><p ng-switch-when=2 class=text-center>El fichero está corrupto o no tiene un formato de imagen válido (png, jpeg o gif)</p><p ng-switch-when=3 class=text-center>No hemos podido guardar la foto</p><p ng-switch-when=4 class=text-center>¡Este zapato ya se encuentra en el almacen!</p><p ng-switch-default="" class=text-center>{{imagesError.msg}}</p></div><div data-file-dropzone="[image/png, image/jpg, image/jpeg, image/gif]" data-max-file-size=2 data-on-file-change=newFile(file) data-file-input=true data-upload-file-text="ARRASTRA TUS FOTOS AQUÍ" data-file-error=imagesError data-file-loading=progress data-upload-file-wrapper-class=div.col-lg-12 data-read-file-as=data class="row first-row"><div class="col-sm-6 col-md-3" style=margin-top:20px ng-repeat="img in $parent.images"><a href=# class=thumbnail><img src={{img.data}} alt={{img.name}}></a><p class=text-center><span>{{img.name}}</span><span ng-click=$parent.$parent.closeImg($index) style=margin-left:10px;font-size:20px;cursor:pointer>&times;</span></p></div></div><div ng-show=progress class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div><div class=row><div class=col-lg-3><label>Referencia (*)</label><div ng-class="{\'has-error\': kz.shoeAddForm.needsAttention(shoeAddForm.reference)}"><input class=form-control ng-model=reference placeholder=Referencia name=reference ng-pattern=/^[0-9A-Za-z\\-\\_]{3,}$/ required></div><span class=help-block>Identificador único. Puede utilizar su lector de código de barras.</span></div><div class=col-lg-3><label>Marca (*)</label><div ng-class="{\'has-error\': kz.shoeAddForm.needsAttention(shoeAddForm.brand)}"><input class=form-control ng-model=brand placeholder=Modelo name=brand required></div><span class=help-block>El modelo de fábrica del producto</span></div><div class=col-lg-3><label>Precio (*)</label><div class=input-group ng-class="{\'has-error\': kz.shoeAddForm.needsAttention(shoeAddForm.price)}"><input type=number class=form-control placeholder=Precio min=0 ng-model=price name=price step=0.1 required></div><span class=help-block>Por defecto se utilizan euros.</span></div><div class=col-lg-3><label>Cantidad (*)</label><div ng-class="{\'has-error\': kz.shoeAddForm.needsAttention(shoeAddForm.quantity)}"><input type=number class=form-control placeholder=Cantidad min=1 ng-model=quantity name=quantity ng-minlength=1 required></div><span class=help-block>Indique el número de artículos que dispone para este producto</span></div></div><div class=row><div class=col-lg-3><label>Talla (*)</label><div ng-class="{\'has-error\': kz.shoeAddForm.needsAttention(shoeAddForm.size)}"><input type=number class=form-control ng-model=size name=size placeholder=Talla min=9 max=49 required></div><span class=help-block>Tamaño o talla del producto</span></div><div class=col-lg-3><label>Color (*)</label><div ng-class="{\'has-error\': kz.shoeAddForm.needsAttention(shoeAddForm.color)}"><input class=form-control ng-model=color name=color typeahead="item as item.color for item in colors | filter:$viewValue | limitTo:8" autocomplete=off typeahead-template-url=searchAutocompleteTpl.html placeholder=Color required></div><span class=help-block>El color del producto</span></div><div class=col-lg-3><label>Categoría</label><div><select class=form-control data-ng-model=category ng-options="v for v in [\'HOMBRES\',\'MUJERES\',\'NIÑOS\']"></select></div><span class=help-block>Grupo o categoría a la que pertence el producto</span></div><div class=col-lg-3><label>Temporada</label><div><select class=form-control data-ng-model=season ng-options="v for v in [\'VERANO\',\'INVIERNO\']"></select></div><span class=help-block>Indique si pertenece a la temporada verano o invierno</span></div></div><div class=row><div class=col-lg-3><label>Fabricante</label><input class=form-control ng-model=maker placeholder=Fabricante><span class=help-block>Fabricante del producto</span></div><div class=col-lg-3><label>Proveedor</label><input class=form-control ng-model=provider placeholder=Proveedor><span class=help-block>Proveedor del producto</span></div><div class=col-lg-3><label>Palabras Clave</label><input class=form-control ng-model=keywords placeholder=Keywords><span class=help-block>Indique palabras separadas por coma que hagan referencia al producto. Ej: piel, seminuevo, ganga</span></div><div class=col-lg-3><label>Ubicación</label><input class=form-control ng-model=location placeholder=Ubicación><span class=help-block>Indique el número de la estantería dentro del almacen donde se localiza el producto</span></div></div><div class=row><div class=col-lg-6><label>Descripción</label><textarea class=form-control ng-model=description rows=3></textarea><span class=help-block>Descripción del producto</span></div><div class=col-lg-6><label>Comentarios</label><textarea class=form-control ng-model=comments rows=3></textarea><span class=help-block>Comentarios del producto</span></div></div></form></div><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Añadir Nuevo Zapato</h3><div class="btn-group pull-right"><a ui-sref=shoes class="btn btn-default"><span class="glyphicon glyphicon-remove-circle"></span></a> <button data-ng-click=create() class="btn btn-default"><span class="glyphicon glyphicon-ok-circle"></span></button></div></div></div></div>'),a.put("/static/partials/shoe_onemore.html",'<div class=table-responsive><form kz-submit=addShoe() name=shoeForm novalidate><table class="table text-center" style=margin-bottom:0><tbody><tr style="border-bottom:1px dotted #CAC5C5"><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.shoeForm.needsAttention(shoeForm.reference)}"><input class=form-control ng-model=reference name=reference placeholder=Referencia ng-pattern=/^[0-9A-Za-z\\-\\_]{3,}$/ required></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.shoeForm.needsAttention(shoeForm.brand)}"><input class=form-control ng-model=brand name=brand placeholder=Marca required></div></td><td class=active><div class=input-group-sm><select class=form-control data-ng-model=category ng-options="v for v in [\'HOMBRES\',\'MUJERES\',\'NIÑOS\']"></select></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.shoeForm.needsAttention(shoeForm.color)}"><input class=form-control ng-model=color name=color typeahead="item as item.color for item in colors | filter:$viewValue | limitTo:8" autocomplete=off typeahead-template-url=searchAutocompleteTpl.html placeholder=Color required></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.shoeForm.needsAttention(shoeForm.size)}"><input type=number class="form-control btn-sm" ng-model=size name=size placeholder=Talla min=9 max=49 required></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.shoeForm.needsAttention(shoeForm.price)}"><input type=number step=0.10 class="form-control btn-sm" placeholder=Precio ng-model=price min=0 name=price pattern=[0-9]+(\\\\.[0-9][0-9]?)? required></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.shoeForm.needsAttention(shoeForm.quantity)}"><input type=number class="form-control btn-sm" placeholder=Cantidad min=1 ng-model=quantity name=quantity ng-minlength=1 required></div></td><td class=active><button class="btn btn-default btn-sm" type=button data-ng-click=reset()><span class="glyphicon glyphicon-trash"></span></button></td><td class=active><input type=submit class="btn btn-primary btn-sm" value=Guardar></td></tr></tbody></table></form></div>'),a.put("/static/partials/shoe_search.html",'<div class=table-responsive><table class="table text-center" style=margin-bottom:0><tbody><tr style="border-bottom:1px dotted #CAC5C5"><td class=active><div class=input-group-sm><input class=form-control ng-model=$parent.query.brand typeahead="item for item in brands | filter:$viewValue | limitTo:10" autocomplete=off placeholder=Marca data-ng-disabled="pagination.totalItems < 1 && !searching" typeahead-on-select=pagination.search() data-ng-change="updateSearch(\'brand\')"></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=$parent.query.color typeahead="item as item.color for item in colors | filter:$viewValue | limitTo:8" autocomplete=off typeahead-template-url=searchAutocompleteTpl.html placeholder=Color data-ng-change=pagination.search() typeahead-on-select=pagination.search()></div></td><td class=active><div class=input-group-sm><input type=number class=form-control ng-model=$parent.query.size data-ng-change=pagination.search() placeholder=Talla min=18 max=45 required></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=$parent.query.category typeahead="item for item in [\'HOMBRES\',\'MUJERES\',\'NIÑOS\'] | filter:$viewValue " autocomplete=off placeholder=Categoría data-ng-change="updateSearch(\'category\')" typeahead-on-select=pagination.search()></div></td></tr></tbody></table></div>'),a.put("/static/partials/shoes.html",'<div class=container><div class="panel panel-default panel-custom"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Stock de Zapatos</h3><div class="btn-group pull-right"><a ui-sref=newShoe class="btn btn-default">Añadir Nuevo</a> <a ui-sref=shoes.onemore class="btn btn-default"><span class="glyphicon glyphicon-plus"></span></a></div></div><div class="panel-heading clearfix"><div class=pull-left><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Mostrar</span><select class=form-control data-ng-model=pagination.itemsPerPage ng-options="v for v in [10,20,40,80]" data-ng-click=pagination.setItemsPerPage() data-ng-disabled="pagination.totalItems < 1" style=width:70px></select></div><div class="btn-group pull-left"><script type=text/ng-template id=ModalImportShoes.html><div class="modal-content">\n                    <div class="modal-header">\n                      <button type="button" class="close" ng-click="cancel()">&times;</button>\n                      <h4 class="modal-title">Importar Zapatos</h4>\n                    </div>\n                    <div class="modal-body">\n                      <div data-file-dropzone="[\'text/csv\', \'text/plain\']" data-max-file-size="3" data-on-file-change="newFile(file)" data-file-input="true" data-upload-file-text="Arrastra tus ficheros CSV aquí &hellip;" data-file-error="fileError" data-file-loading="progress" data-read-file-as="text" style="margin-top:20px">\n                      </div>\n                       <div ng-switch="fileError.code" ng-show="fileError.visible" class="alert alert-danger" style="margin-top:10px;">\n                        <p ng-switch-when="1" class="text-center">El fichero supera los 3 MBytes</p>\n                        <p ng-switch-when="2" class="text-center">¡Selecciona un fichero CSV!</p>\n                        <p ng-switch-when="3" class="text-center">¡Algunos datos estan duplicados o estan mal formateados!</p>\n                        <p ng-switch-default class="text-center">{{fileError.msg}}</p>\n                      </div>\n                      <div ng-show="progress" class="progress progress-striped active">\n                        <div class="progress-bar" style="width: 100%">\n                        </div>\n                      </div>\n                      <div ng-show="files.length > 0" style="margin-top:20px;">\n                        <div class="input-group" style="width:350px;margin:auto;">\n                          <span class="input-group-addon">\n                            <input type="checkbox" ng-model="$parent.remove" >\n                          </span>\n                          <p class="form-control text-center">Borrar todos los zapatos antiguos</p>\n                        </div>\n                      </div>\n                      <div ng-show="displayCSV" style="margin-top:20px;">\n                        <tabset>\n                          <tab ng-repeat="file in files" active="tab.active" disabled="tab.disabled">\n                            <tab-heading>{{file.name}}<span class="close" style="margin-left:15px;" ng-click="closeTab($index)">&times;</span></tab-heading>\n                            <div json-table="{{$index}}" json-table-data="$parent.files" json-table-loaded="$parent.progress" json-table-active="$parent.displayCSV" style="overflow:auto;height:220px;"></div>\n                          </tab>\n                        </tabset>\n                      </div>\n                    </div>\n                    <div class="modal-footer">\n                      <button type="button" class="btn btn-default" ng-click="cancel()">Cancelar</button>\n                      <button type="button" class="btn btn-info" ng-show="files.length > 0 && !displayCSV" ng-click="display()">Ver</button>\n                      <button type="button" class="btn btn-primary" ng-show="files.length > 0" ng-click="ok()">Importar Zapatos</button>\n                    </div>\n                  </div><!-- /.modal-content --></script><script type=text/ng-template id=ModalQRShoes.html><div class="modal-content">\n                    <div class="modal-header">\n                      <h4 class="modal-title">Código QR</h4>\n                    </div>\n                    <div class="modal-body">\n                      <p ng-show="progress" class="text-center">Espere por favor &hellip;</p>\n                      <div ng-show="progress" class="progress progress-striped active">  \n                        <div class="progress-bar" style="width: 100%"></div>\n                      </div>\n                      <p ng-show="!progress && !error">Ahora puedes imprimir o copiar su código QR y comenzar a leerlo con su lector QR preferido</p>\n                      <div ng-show="error" class="alert alert-danger" style="margin-top:10px;">\n                        <p class="text-center">Ha ocurrido un error mientras obteníamos el código QR. ¡Ya hemos avisado a Zuri!</p>\n                      </div>\n                      <div class="text-center"><img ng-show="!progress && !error" src="{{qr}}"/></div>\n                    </div>\n                    <div class="modal-footer">\n                      <button type="button" class="btn btn-info" ng-show="!progress && !error" ng-click="print()">Imprimir</button>\n                      <button type="button" class="btn btn-info" ng-show="!progress" ng-click="ok()">Salir</button>\n                    </div>\n                  </div><!-- /.modal-content --></script><script type=text/ng-template id=ModalBCShoes.html><div class="modal-content">\n                    <div class="modal-header">\n                      <h4 class="modal-title">Código de Barras</h4>\n                    </div>\n                    <div class="modal-body">\n                      <p ng-show="progress" class="text-center">Espere por favor &hellip;</p>\n                      <div ng-show="progress" class="progress progress-striped active">  \n                        <div class="progress-bar" style="width: 100%"></div>\n                      </div>\n                      <p ng-show="!progress && !error" style="margin-bottom:30px;">Ahora puedes imprimir o copiar el código de barras que se muestra a continuación. Nota: El código de barras sigue el modelo <stron>Code 128</strong>.</p>\n                      <div ng-show="error" class="alert alert-danger" style="margin-top:10px;">\n                        <p class="text-center">Ha ocurrido un error mientras obteníamos el código de barras. ¡Ya hemos avisado a Zuri!</p>\n                      </div>\n                      <div class="text-center">\n                        <img img-load="barcode" img-load-error="onError(index)" img-load-success="progress = false" ng-show="!progress && !error" />\n                      </div>\n                    </div>\n                    <div class="modal-footer">\n                      <button type="button" class="btn btn-info" ng-show="!progress && !error" ng-click="print()">Imprimir</button>\n                      <button type="button" class="btn btn-info" ng-show="!progress" ng-click="ok()">Salir</button>\n                    </div>\n                  </div><!-- /.modal-content --></script><script type=text/ng-template id=ModalPrintShoes.html><div class="modal-content">\n                    <div class="modal-header">\n                      <h4 class="modal-title">Impresión Códigos de Barras</h4>\n                    </div>\n                    <div class="modal-body">\n                      <p ng-show="progress" class="text-center">Espere por favor &hellip;</p>\n                      <div ng-show="progress" class="progress progress-striped active">  \n                        <div class="progress-bar" style="width: 100%"></div>\n                      </div>\n                      <p ng-show="!progress && !error" style="margin-bottom:30px;">Ya puedes descargar una copia con todos los códigos de barra de tus zapatos e imprimirla. Nota: El documento generado está en formato pdf, con estilo de página A4.</p>\n                      <div ng-show="error" class="alert alert-danger" style="margin-top:10px;">\n                        <p class="text-center">Ha ocurrido un error mientras obteníamos el código de barras. ¡Ya hemos avisado a Zuri!</p>\n                      </div>\n                    </div>\n                    <div class="modal-footer">\n                      <a class="btn btn-info" ng-show="!progress && !error" ng-href="{{pdf}}" download="zapatos_barcodes.pdf" target="_self">Descargar</a>\n                      <button type="button" class="btn btn-info" ng-show="!progress" ng-click="ok()">Salir</button>\n                    </div>\n                  </div><!-- /.modal-content --></script><div class=btn-group><a class="btn btn-default btn-sm" ng-click=openPrint() data-ng-disabled="pagination.totalItems < 1"><span class="glyphicon glyphicon-print"></span></a> <button type=button class="btn btn-default btn-sm" ng-click=openImport()>Importar</button> <a data-ng-disabled="pagination.totalItems < 1" class="btn btn-default btn-sm" ng-href=/api/shoes/export/csv download=zapatos.csv target=_self>Exportar</a> </div></div></div><div class=pull-right><div class="input-group input-group-sm"><input class=form-control ng-model=query.reference typeahead="item for item in references | filter:$viewValue | limitTo:10" autocomplete=off placeholder=Buscar data-ng-disabled="pagination.totalItems < 1 && !searching" typeahead-on-select=pagination.search() data-ng-change="updateSearch(\'reference\')"><span class=input-group-btn><button class="btn btn-default btn-sm" type=button data-ng-disabled=!searching data-ng-click=delSearch()><span class="glyphicon glyphicon-trash"></span></button> <a class="btn btn-default btn-sm" type=button data-ng-disabled="pagination.totalItems < 1 && !searching" ui-sref=shoes.search><span class="glyphicon glyphicon-zoom-in"></span></a></span></div></div></div><div ui-view=""></div><div class=panel-body><div class=table-responsive data-ng-show="pagination.totalItems > 0 && !progress"><table class="table text-center"><thead><tr><th>Referencia <a ng-click="orderShoes(\'reference\')"><span ng-show="caret[\'reference\']" class=caret></span></a><div class=dropup ng-show="!caret[\'reference\']" ng-click="orderShoes(\'reference\')"><span class=caret></span></div></th><th>Marca <a ng-click="orderShoes(\'brand\')"><span ng-show="caret[\'brand\']" class=caret></span></a><div class=dropup ng-show="!caret[\'brand\']" ng-click="orderShoes(\'brand\')"><span class=caret></span></div></th><th>Categoría <a ng-click="orderShoes(\'category\')"><span ng-show="caret[\'category\']" class=caret></span></a><div class=dropup ng-show="!caret[\'category\']" ng-click="orderShoes(\'category\')"><span class=caret></span></div></th><th>Color <a ng-click="orderShoes(\'color\')"><span ng-show="caret[\'color\']" class=caret></span></a><div class=dropup ng-show="!caret[\'color\']" ng-click="orderShoes(\'color\')"><span class=caret></span></div></th><th>Talla <a ng-click="orderShoes(\'size\')"><span ng-show="caret[\'size\']" class=caret></span></a><div class=dropup ng-show="!caret[\'size\']" ng-click="orderShoes(\'size\')"><span class=caret></span></div></th><th>Precio <a ng-click="orderShoes(\'price\')"><span ng-show="caret[\'price\']" class=caret></span></a><div class=dropup ng-show="!caret[\'price\']" ng-click="orderShoes(\'price\')"><span class=caret></span></div></th><th>Cantidad <a ng-click="orderShoes(\'quantity\')"><span ng-show="caret[\'quantity\']" class=caret></span></a><div class=dropup ng-show="!caret[\'quantity\']" ng-click="orderShoes(\'quantity\')"><span class=caret></span></div></th><th>Acción</th></tr></thead><tbody><tr data-ng-repeat="item in items" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.brand}}</td><td>{{item.category}}</td><td><span class=color_circle style=background-color:{{getColorCode(item.color)}}></span> {{item.color}}</td><td>{{item.size}}</td><td>{{item.price}} &euro;</td><td>{{item.quantity}} <span ng-pluralize="" count=item.quantity when="{\'1\': \'ud.\',\'other\': \'uds.\'}"></span></td><td><a class="btn btn-success btn-sm" data-ng-click="editShoe(item[\'_id\'])" title="Ver Detalle"><span class="glyphicon glyphicon-edit"></span></a> <a class="btn btn-danger btn-sm" data-ng-click="removeShoe(item[\'_id\'])" title=Borrar><span class="glyphicon glyphicon-remove"></span></a> <a class="btn btn-sm" ng-class="{\'btn-info\':item[\'has_qr\'],\'btn-warning\':!item[\'has_qr\']}" data-ng-click="qrCode(item[\'_id\'], item[\'has_qr\'], $index)" title="Código QR"><span class="glyphicon glyphicon-qrcode"></span></a> <a class="btn btn-primary btn-sm" data-ng-click="barCode(item[\'barcode\'])" title="Código de Barras"><span class="glyphicon glyphicon-barcode"></span></a></td></tr></tbody></table></div><div data-ng-show="pagination.totalItems < 1 && !searching && !progress" class="alert alert-warning" style=margin:50px><p class=text-center>Vaya tela, tienes una tienda en la que ... <strong>!No hay ningún zapato!</strong></p><p class=text-center>Deberías incluir alguno. Si quieres, también puedes importarlos desde un fichero CSV.</p></div><div data-ng-show="pagination.totalItems < 1 && searching" class="alert alert-warning" style=margin:50px><p class=text-center><strong>!No hay ningún zapato con los criterios de búsqueda dados!</strong></p></div><div ng-show=progress style="width:300px;margin:20px auto"><div class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div></div></div><div class=panel-footer data-ng-show="pagination.numPages > 1 && !progress"><div class=text-center><pagination boundary-links=true total-items=pagination.totalItems max-size=pagination.maxSize items-per-page=pagination.itemsPerPage page=pagination.currentPage class=pagination-sm num-pages=pagination.numPages previous-text=&lsaquo; next-text=&rsaquo; first-text=&laquo; last-text=&raquo; on-select-page=pagination.setPage(page)></pagination></div><small class=pull-left ng-show="pagination.itemsPerPage*pagination.currentPage>pagination.totalItems">Mostrados {{pagination.itemsPerPage*(pagination.currentPage-1)}} al {{pagination.totalItems}} ({{pagination.totalItems}} resultados en {{pagination.numPages}} páginas)</small> <small class=pull-left ng-show="pagination.itemsPerPage*pagination.currentPage<=pagination.totalItems">Mostrados {{pagination.itemsPerPage*(pagination.currentPage-1)}} al {{pagination.itemsPerPage*pagination.currentPage}} ({{pagination.totalItems}} resultados en {{pagination.numPages}} páginas)</small></div><div class=panel-footer data-ng-show="pagination.numPages <= 1"></div></div></div>'),a.put("/static/partials/tickets.html",'<script type=text/ng-template id=ModalPrintTicket.html><div class="modal-content">\n    <div class="modal-header">\n      <h4 class="modal-title">¡Ya está hecho!</h4>\n    </div>\n    <div class="modal-body">\n      \n      <div class="text-center">\n        <p>A continuación se muestra el ticket de compra.</p><p> Si deseas, puedes modificarlo antes de imprimirlo</p>\n        <textarea class="form-control" ng-model="ticket" rows="12" wrap="off" style="white-space:pre;word-wrap:normal;font-family:monospace;width:385px;margin:auto;"></textarea>\n      </div>\n\n    </div>\n    <div class="modal-footer">\n      <button type="button" class="btn btn-primary" ng-click="print()">Imprimir Ticket</button>\n      <button type="button" class="btn btn-default" ng-click="ok()">Salir</button>\n    </div>\n  </div><!-- /.modal-content --></script><div class=container><div class=row ng-show=processingTicket><div class="col-xs-12 col-md-12"><div class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div></div></div><div class=row data-ng-show="ticketNotice.visible && !progress" data-ng-switch=ticketNotice.code><div class="col-xs-12 col-md-12" ng-switch-when=1><div class="alert alert-danger"><p class=text-center>Venta Realizada con problemas</p></div></div><div class="col-xs-12 col-md-12" ng-switch-when=2><div class="alert alert-success"><p class=text-center><strong>¡ La venta se ha realizado con éxito !</strong></p></div></div><div class="col-xs-12 col-md-12" ng-switch-when=3><div class="alert alert-danger"><p class=text-center>¡Hemos tenido problemas con la conexión. Inténtalo de nuevo!</p></div></div><div class="col-xs-12 col-md-12" ng-switch-when=4><div class="alert alert-success"><p class=text-center><strong>¡ La reserva se ha realizado con éxito !</strong></p></div></div></div><div ng-show=progress style=width:300px;margin:auto;height:50px;position:absolute;top:50%;left:50%;margin-top:-25px;margin-left:-150px><p class=text-center>Cargando, espere por favor &hellip;</p><div class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div></div><div class=row ng-show=!progress><div class="col-xs-12 col-md-9"><div ui-view=""></div><div class="panel panel-default panel-custom" data-ng-show=!oldTicketActived><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Venta de Stock</h3><div class="btn-group pull-right"><button class="btn btn-default" data-ng-disabled="ticketTotal == 0" data-ng-click=newTicket()>Nuevo Ticket</button> <button class="btn btn-default" data-ng-click="finishTicket(\'save\',true)" data-ng-disabled="ticketTotal == 0 || processingTicket">Reservar</button> <button class="btn btn-default" data-ng-click="finishTicket(\'order\',true)" data-ng-disabled="(ticketPM != \'credit\' && !hasPaid()) || ticketTotal == 0 || processingTicket">Terminar</button></div></div><div class=panel-body><div class=table-responsive data-ng-show="products.length > 0"><table class="table text-center"><thead><tr><th>Referencia</th><th>Descripción</th><th>Cantidad</th><th>PVP</th><th>Dto.</th><th>Subtotal</th><th>Quitar</th></tr></thead><tbody><tr data-ng-repeat="item in products" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.description}}</td><td><span class="glyphicon glyphicon-chevron-left pointer" ng-show="item.quantity > 1 && !changingQty" ng-click="decQty($index,item.type == \'s\')"></span> {{item.quantity}} <span class="glyphicon glyphicon-chevron-right pointer" ng-show="(item.shoe_qty > 0 && !changingQty) || item.type == \'c\'" ng-click="incQty($index,item.type == \'s\')"></span></td><td>{{item.price}}</td><td><input ng-model=item.discount class=inline-editing-inactive data-ng-change=applySubRate($index)></td><td>{{item.subtotal}}</td><td><button type=button class="btn btn-danger btn-sm" data-ng-click="removeFromTicket($index,item.type == \'s\')"><span class="glyphicon glyphicon-remove"></span></button></td></tr></tbody></table></div><div data-ng-show="products.length == 0" class="alert alert-warning" style=margin:50px><p class=text-center>Este ticket está vacío. No has añadido ningún producto aún.</p><p class=text-center>Puedes buscar los zapatos o complementos en el panel inferior</p></div></div><div class="panel-footer clearfix"><div class=pull-left><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Impuesto (%)</span><input type=number class=form-control min=0 max=21 ng-model=ticketTax step=1 style=width:70px data-ng-disabled="ticketTotal == 0" data-ng-change=applyRate(true)></div><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Descuento (%)</span><input type=number class=form-control min=0 ng-model=ticketDiscount step=1 style=width:70px data-ng-disabled="ticketTotal == 0" data-ng-change=applyRate(false)></div></div><div class="btn-group pull-right"><button type=button data-ng-disabled="(ticketPM != \'credit\' && !hasPaid()) || ticketTotal == 0 || processingTicket" data-ng-click="finishTicket(\'order\',false)" class="btn btn-sm btn-success"><span class="glyphicon glyphicon-shopping-cart"></span> Deprisa</button></div></div></div><div><tabset id=tickets-tab><tab><tab-heading>Zapatos<span class="glyphicon glyphicon-refresh" style=margin-left:15px;cursor:pointer ng-click=shoes.pagination.search()></span></tab-heading><div class="panel panel-default"><div class=panel-body><div class=table-responsive><table class="table text-center searchable"><tbody><tr><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.barcode placeholder="Código Barras" data-ng-change=shoes.pagination.search()></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.reference typeahead="item for item in shoes.references | filter:$viewValue | limitTo:6" autocomplete=off placeholder=Referencia typeahead-on-select=shoes.pagination.search() data-ng-change=shoes.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.brand typeahead="item for item in shoes.brands | filter:$viewValue | limitTo:6" autocomplete=off placeholder=Marca typeahead-on-select=shoes.pagination.search() data-ng-change=shoes.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.color typeahead="item as item.color for item in colors | filter:$viewValue | limitTo:6" autocomplete=off typeahead-template-url=searchAutocompleteTpl.html placeholder=Color data-ng-change=shoes.pagination.search() typeahead-on-select=shoes.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input type=number class=form-control ng-model=shoes.size data-ng-change=shoes.pagination.search() placeholder=Talla min=18 max=45 style=width:65px></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.category typeahead="item for item in [\'HOMBRES\',\'MUJERES\',\'NIÑOS\'] | filter:$viewValue " autocomplete=off placeholder=Categoría data-ng-change=shoes.pagination.search() typeahead-on-select=shoes.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><button class="btn btn-default btn-sm" type=button data-ng-click=shoes.reset()><span class="glyphicon glyphicon-trash"></span></button></td></tr></tbody></table></div><div class=table-responsive data-ng-show="shoes.pagination.totalItems > 0"><table class="table text-center"><thead><tr><th>Referencia</th><th>Marca</th><th>Categoría</th><th>Color</th><th>Talla</th><th>Precio</th><th>Cantidad</th><th>Acción</th></tr></thead><tbody><tr data-ng-repeat="item in shoes.items" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.brand}}</td><td>{{item.category}}</td><td><span class=color_circle style=background-color:{{getColorCode(item.color)}}></span> {{item.color}}</td><td>{{item.size}}</td><td>{{item.price}} &euro;</td><td>{{item.quantity}} <span ng-pluralize="" count=item.quantity when="{\'1\': \'ud.\',\'other\': \'uds.\'}"></span></td><td><button type=button class="btn btn-primary btn-sm" data-ng-disabled="item.quantity == 0" data-ng-click=addToTicket(true,$index)>Añadir</button></td></tr></tbody></table></div><div class=text-center data-ng-show="shoes.pagination.pages > 1"><pagination boundary-links=true total-items=shoes.pagination.totalItems max-size=shoes.pagination.maxSize items-per-page=shoes.pagination.itemsPerPage page=shoes.pagination.currentPage class=pagination-sm previous-text=&lsaquo; next-text=&rsaquo; first-text=&laquo; last-text=&raquo; on-select-page=shoes.pagination.setPage(page) num-pages=shoes.pagination.pages></pagination></div></div></div></tab><tab heading=Complementos><div class="panel panel-default"><div class=panel-body><div class=table-responsive><form kz-submit=addToTicket(false) name=ticketsComplementsForm novalidate><table class="table text-center searchable"><tbody><tr><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.ticketsComplementsForm.needsAttention(ticketsComplementsForm.creference)}"><input class=form-control ng-model=complements.reference typeahead="item for item in complements.references | filter:$viewValue | limitTo:6" autocomplete=off placeholder=Referencia typeahead-position=shoes.thPosition name=creference required></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=complements.brand placeholder=Marca></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=complements.color typeahead="item as item.color for item in colors | filter:$viewValue | limitTo:8" autocomplete=off typeahead-template-url=searchAutocompleteTpl.html placeholder=Color typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.ticketsComplementsForm.needsAttention(ticketsComplementsForm.cprice)}"><input type=number class=form-control ng-model=complements.price placeholder=Precio name=cprice min=0 required></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.ticketsComplementsForm.needsAttention(ticketsComplementsForm.cquantity)}"><input type=number class=form-control ng-model=complements.quantity placeholder=Cantidad name=cquantity min=1 required></div></td><td class=active><button class="btn btn-default btn-sm" type=button data-ng-click=complements.reset()><span class="glyphicon glyphicon-trash"></span></button></td><td class=active><input type=submit class="btn btn-primary btn-sm" value=Añadir></td></tr></tbody></table></form></div></div></div></tab><tab heading=Tickets><div class="panel panel-default"><div class=panel-body><div class=table-responsive><table class="table text-center searchable"><tbody><tr><td class=active><div class=input-group-sm><input class=form-control ng-model=tickets.code typeahead="item for item in tickets.codes | filter:$viewValue | limitTo:10" autocomplete=off placeholder=Código typeahead-on-select=tickets.pagination.search() data-ng-change=tickets.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=tickets.date placeholder=Fecha data-ng-change=tickets.pagination.search()></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=tickets.employee typeahead="item for item in tickets.employees | filter:$viewValue | limitTo:10" autocomplete=off placeholder=Empleado typeahead-on-select=tickets.pagination.search() data-ng-change=tickets.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=tickets.state typeahead="item for item in tickets.states | filter:$viewValue | limitTo:8" autocomplete=off placeholder=Estado data-ng-change=tickets.pagination.search() typeahead-position=shoes.thPosition typeahead-on-select=tickets.pagination.search()></div></td><td class=active><button class="btn btn-default btn-sm" type=button data-ng-click=tickets.reset()><span class="glyphicon glyphicon-trash"></span></button> <button type=button class="btn btn-primary btn-sm" ng-click=tickets.setToday()>Hoy</button></td></tr></tbody></table></div><div class=table-responsive data-ng-show="tickets.pagination.totalItems > 0"><table class="table text-center"><thead><tr><th>Código</th><th>Fecha</th><th>Empleado</th><th>Estado</th><th>Acción</th></tr></thead><tbody><tr data-ng-repeat="item in tickets.items" data-ng-class="{active: ($index%2)==0}"><td>{{item.code}}</td><td>{{tickets.parseDate(item.date_end)}}</td><td>{{item.employee}}</td><td>{{item.status}}</td><td><button type=button class="btn btn-danger btn-sm" data-ng-show="item.status == \'RESERVADO\'" data-ng-click="tickets.abortTicket(item.code, $index)" data-ng-disabled=item.disabled>Anular</button> <a ui-sref="tickets.reserve({ code: item.code })" class="btn btn-success btn-sm" data-ng-show="item.status == \'RESERVADO\'">Cobrar</a> <a ui-sref="tickets.return({ code: item.code })" class="btn btn-danger btn-sm" data-ng-show="item.status == \'VENDIDO\'">Devolver</a> <button type=button class="btn btn-success btn-sm" data-ng-show="item.status == \'VENDIDO\'" data-ng-click=tickets.reprintTicket($index)>Reimprimir</button></td></tr></tbody></table></div><div class=text-center data-ng-show="tickets.pagination.pages > 1"><pagination boundary-links=true total-items=tickets.pagination.totalItems max-size=tickets.pagination.maxSize items-per-page=tickets.pagination.itemsPerPage page=tickets.pagination.currentPage class=pagination-sm previous-text=&lsaquo; next-text=&rsaquo; first-text=&laquo; last-text=&raquo; on-select-page=tickets.pagination.setPage(page) num-pages=tickets.pagination.pages></pagination></div></div></div></tab><tab heading=Caja><div class="panel panel-default"><div class=panel-body><div class=table-responsive><table class="table text-center searchable"><tbody><tr><td class=active><div class=input-group-sm><input class=form-control placeholder=Fecha data-ng-model=box.date></div></td><td class=active><div class=input-group-sm><input type=number class=form-control placeholder="Deposito Inicial" min=0 data-ng-model=box.initialCash data-ng-change=box.applyInitCash()></div></td><td class=active><button class="btn btn-default btn-sm" type=button data-ng-click=box.reset()><span class="glyphicon glyphicon-trash"></span></button><div class=btn-group><button type=button class="btn btn-sm btn-default" ng-click=box.makeBox()>Hacer Caja</button> <button type=button class="btn btn-sm btn-default dropdown-toggle" ng-disabled="box.total == 0 || !box.result.length"><span class=caret></span></button><ul class=dropdown-menu><li><a ng-click=box.printToPDF()>Imprimir PDF</a></li><li><a ng-click=box.printToTicket()>Imprimir Ticket</a></li></ul></div></td><td class=active ng-show=box.result.length><div class=input-group-sm><span class=input-group-addon style=text-align:center;width:90px>{{box.total}} &euro;</span></div></td></tr></tbody></table></div><div style=margin:50px ng-show=box.progress><div class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div></div><div class="alert alert-warning" style=margin:50px ng-show="!box.progress && !box.result.length"><p class=text-center><strong>¡ Hoy no se ha realizado ninguna operación ... !</strong></p><p class=text-center>Recuerda, desde esta sección puedes obtener un resumen de las operaciones realizadas al cabo de la joranada laboral.</p></div><div class=table-responsive ng-show="!box.progress && box.result.length"><table id=tickets_box_summary class="table text-center"><thead><tr><th>Emplead@</th><th>Ventas</th><th>Dev. (Vale)</th><th>Dev. (&euro;)</th><th>Reservas</th><th>T. Efectivo</th><th>T. Tarjeta</th><th>T. Devuelto</th><th>Total (&euro;)</th><th>Caja (&euro;)</th></tr></thead><tbody class=box-resume><tr data-ng-repeat="item in box.result" data-ng-class="{active: ($index%2)==0 && $index+1<box.result.length}"><td>{{item.employee}}</td><td>{{item.ordered}}</td><td>{{item.returned_voucher}}</td><td>{{item.returned_cash}}</td><td>{{item.booked}}</td><td>{{item.total_cash}}</td><td>{{item.total_credit}}</td><td>{{item.total_rcash}}</td><td>{{item.total}}</td><td>{{item.total_box}}</td></tr></tbody></table></div></div></div></tab></tabset></div></div><div class="col-xs-12 col-md-3"><div class="panel panel-default"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Resumen Venta</h3></div><div class=panel-body><div class=text-center><div class=form-group><label class=control-label for=ticket_total style=font-size:28px>TOTAL</label><div class=input-group><input class="form-control total-ticket" id=ticket_total data-ng-model=ticketTotal disabled><span class=input-group-addon>&euro;</span></div></div><div class="form-group has-success"><label class=control-label for=ticket_received style=font-size:28px>ENTREGA</label><div class=input-group><input class="form-control total-ticket" style=background-color:#D7EFDB data-ng-model=ticketReceived id=ticket_received data-ng-change=computeExchange() data-ng-disabled="ticketPM == \'credit\' || ticketPM == \'combined\'"><span class=input-group-addon>&euro;</span></div></div><div class="form-group has-error"><label class=control-label for=ticket_returned style=font-size:28px>CAMBIO</label><div class=input-group><input class="form-control total-ticket" style=background-color:#f2dede data-ng-model=ticketReturned id=ticket_returned disabled><span class=input-group-addon>&euro;</span></div></div></div></div><div class=panel-footer></div></div><div class="panel panel-default" data-ng-show="ticketTotal != 0"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Forma de Pago</h3></div><div class=panel-body><div><div class=radio><label for=ticket_paymethod_cash><input type=radio id=ticket_paymethod_cash data-ng-model=ticketPM value=cash data-ng-click=payment_method.reset()>Efectivo</label></div><div class=radio data-ng-show="ticketTotal > 0"><label for=ticket_paymethod_credit><input type=radio id=ticket_paymethod_credit data-ng-model=ticketPM value=credit data-ng-click=payment_method.reset()>Tarjeta Crédito</label></div><div class=radio><label for=ticket_paymethod_voucher><input type=radio id=ticket_paymethod_voucher data-ng-model=ticketPM value=voucher data-ng-click="payment_method.reset(\'voucher\')">Cheque Vale</label><div ng-show=payment_method.voucher style=position:relative;left:-20px><table style="margin:10px 0"><tr><td><div data-ng-class="{\'has-error\': payment_method.voucher_code_error}"><input class=form-control data-ng-model=payment_method.voucher_code></div></td><td><button class="btn btn-default" type=button data-ng-click=payment_method.validate()><span class="glyphicon glyphicon-question-sign"></span></button></td></tr></table></div></div><div class=radio data-ng-show="ticketTotal > 0"><label for=ticket_paymethod_combined><input type=radio id=ticket_paymethod_combined data-ng-model=ticketPM value=combined data-ng-click="payment_method.reset(\'combined\')">Pago Combinado</label><div ng-show=payment_method.combined style="margin:15px 0;position:relative;left:-20px"><div>Efectivo:<input type=number min=0 class=form-control placeholder=Efectivo data-ng-model=payment_method.combined_cash data-ng-change=payment_method.compute_combined()></div><div style=margin-top:5px>Tarjeta Credito:<input type=number min=0 class=form-control placeholder="Tarjeta Crédito" data-ng-model=payment_method.combined_credit data-ng-change=payment_method.compute_combined()></div><div style=margin-top:5px>Cheque Vale:<input type=number min=0 class=form-control placeholder="Cheque Vale" data-ng-model=payment_method.combined_voucher data-ng-change=payment_method.compute_combined()></div><div style=margin-top:8px data-ng-show="payment_method.combined_needed > 0"><p>HASTA TOTAL FALTAN: {{payment_method.combined_needed}} EUROS</p></div></div></div></div></div><div class=panel-footer></div></div></div></div></div>'),a.put("/static/partials/tickets_bk.html",'<div class=container><div class=row ng-show=processingTicket><div class="col-xs-12 col-md-12"><div class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div></div></div><div class=row data-ng-show="ticketNotice.visible && !progress" data-ng-switch=ticketNotice.code><div class="col-xs-12 col-md-12" ng-switch-when=1><div class="alert alert-danger"><p class=text-center>Venta Realizada con problemas</p></div></div><div class="col-xs-12 col-md-12" ng-switch-when=2><div class="alert alert-success"><p class=text-center><strong>¡ La venta se ha realizado con éxito !</strong></p></div></div><div class="col-xs-12 col-md-12" ng-switch-when=3><div class="alert alert-danger"><p class=text-center>¡Hemos tenido problemas con la conexión. Inténtalo de nuevo!</p></div></div><div class="col-xs-12 col-md-12" ng-switch-when=4><div class="alert alert-success"><p class=text-center><strong>¡ La reserva se ha realizado con éxito !</strong></p></div></div></div><div ng-show=progress style=width:300px;margin:auto;height:50px;position:absolute;top:50%;left:50%;margin-top:-25px;margin-left:-150px><p class=text-center>Cargando, espere por favor &hellip;</p><div class="progress progress-striped active"><div class=progress-bar style="width: 100%"></div></div></div><div class=row ng-show=!progress><div data-ng-class="{\'col-xs-12 col-md-9\': ticketTotal > 0, \'col-xs-12 col-md-12\': ticketTotal == 0}"><div ui-view=""><div class="panel panel-default panel-custom"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Venta de Stock</h3><div class="btn-group pull-right"><button class="btn btn-default" data-ng-disabled="ticketTotal == 0" data-ng-click=newTicket()>Nuevo Ticket</button> <button class="btn btn-default" data-ng-click="finishTicket(\'save\',true)" data-ng-disabled="ticketTotal == 0 || processingTicket">Reservar</button> <button class="btn btn-default" data-ng-click="finishTicket(\'order\',true)" data-ng-disabled="(ticketPM == \'cash\' && !hasPaid()) || ticketTotal == 0 || processingTicket">Terminar</button></div></div><div class=panel-body><div class=table-responsive data-ng-show="ticketTotal > 0"><table class="table text-center"><thead><tr><th>Referencia</th><th>Descripción</th><th>Cantidad</th><th>PVP</th><th>Dto.</th><th>Subtotal</th><th>Quitar</th></tr></thead><tbody><tr data-ng-repeat="item in products" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.description}}</td><td><span class="glyphicon glyphicon-chevron-left pointer" ng-show="item.quantity > 1 && !changingQty" ng-click="decQty($index,item.type == \'s\')"></span> {{item.quantity}} <span class="glyphicon glyphicon-chevron-right pointer" ng-show="(item.shoe_qty > 0 && !changingQty) || item.type == \'c\'" ng-click="incQty($index,item.type == \'s\')"></span></td><td>{{item.price}}</td><td><input ng-model=item.discount class=inline-editing-inactive data-ng-change=applySubRate($index)></td><td>{{item.subtotal}}</td><td><button type=button class="btn btn-danger btn-sm" data-ng-click="removeFromTicket($index,item.type == \'s\')"><span class="glyphicon glyphicon-remove"></span></button></td></tr></tbody></table></div><div data-ng-show="ticketTotal == 0" class="alert alert-warning" style=margin:50px><p class=text-center>Este ticket está vacío. No has añadido ningún producto aún.</p><p class=text-center>Puedes buscar los zapatos o complementos en el panel inferior</p></div></div><div class="panel-footer clearfix"><div class=pull-left><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Impuesto (%)</span><input type=number class=form-control min=0 max=21 ng-model=ticketTax step=1 style=width:70px data-ng-disabled="ticketTotal == 0" data-ng-change=applyRate(true)></div><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Descuento (%)</span><input type=number class=form-control min=0 ng-model=ticketDiscount step=1 style=width:70px data-ng-disabled="ticketTotal == 0" data-ng-change=applyRate(false)></div></div><div class="btn-group pull-right"><button type=button data-ng-disabled="(ticketPM == \'cash\' && !hasPaid()) || ticketTotal == 0 || processingTicket" data-ng-click="finishTicket(\'order\',false)" class="btn btn-sm btn-success"><span class="glyphicon glyphicon-shopping-cart"></span> Deprisa</button></div></div></div></div><div><tabset id=tickets-tab><tab heading=Zapatos><div class="panel panel-default"><div class=panel-body><div class=table-responsive><table class="table text-center searchable"><tbody><tr><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.barcode placeholder="Código Barras" data-ng-change=shoes.pagination.search()></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.reference typeahead="item for item in shoes.references | filter:$viewValue | limitTo:6" autocomplete=off placeholder=Referencia typeahead-on-select=shoes.pagination.search() data-ng-change=shoes.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.brand typeahead="item for item in shoes.brands | filter:$viewValue | limitTo:6" autocomplete=off placeholder=Marca typeahead-on-select=shoes.pagination.search() data-ng-change=shoes.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.color typeahead="item as item.color for item in colors | filter:$viewValue | limitTo:6" autocomplete=off typeahead-template-url=searchAutocompleteTpl.html placeholder=Color data-ng-change=shoes.pagination.search() typeahead-on-select=shoes.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input type=number class=form-control ng-model=shoes.size data-ng-change=shoes.pagination.search() placeholder=Talla min=18 max=45></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=shoes.category typeahead="item for item in [\'HOMBRES\',\'MUJERES\',\'NIÑOS\'] | filter:$viewValue " autocomplete=off placeholder=Categoría data-ng-change=shoes.pagination.search() typeahead-on-select=shoes.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><button class="btn btn-default btn-sm" type=button data-ng-click=shoes.reset()><span class="glyphicon glyphicon-trash"></span></button></td></tr></tbody></table></div><div class=table-responsive data-ng-show="shoes.pagination.totalItems > 0"><table class="table text-center"><thead><tr><th>Referencia</th><th>Marca</th><th>Categoría</th><th>Color</th><th>Talla</th><th>Precio</th><th>Cantidad</th><th>Acción</th></tr></thead><tbody><tr data-ng-repeat="item in shoes.items" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.brand}}</td><td>{{item.category}}</td><td><span class=color_circle style=background-color:{{getColorCode(item.color)}}></span> {{item.color}}</td><td>{{item.size}}</td><td>{{item.price}} &euro;</td><td>{{item.quantity}} <span ng-pluralize="" count=item.quantity when="{\'1\': \'ud.\',\'other\': \'uds.\'}"></span></td><td><button type=button class="btn btn-primary btn-sm" data-ng-disabled="item.quantity == 0" data-ng-click=addToTicket(true,$index)>Añadir</button></td></tr></tbody></table></div><div class=text-center data-ng-show="shoes.pagination.pages > 1"><pagination boundary-links=true total-items=shoes.pagination.totalItems max-size=shoes.pagination.maxSize items-per-page=shoes.pagination.itemsPerPage page=shoes.pagination.currentPage class=pagination-sm previous-text=&lsaquo; next-text=&rsaquo; first-text=&laquo; last-text=&raquo; on-select-page=shoes.pagination.setPage(page) num-pages=shoes.pagination.pages></pagination></div></div></div></tab><tab heading=Complementos><div class="panel panel-default"><div class=panel-body><div class=table-responsive><form kz-submit=addToTicket(false) name=ticketsComplementsForm novalidate><table class="table text-center searchable"><tbody><tr><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.ticketsComplementsForm.needsAttention(ticketsComplementsForm.creference)}"><input class=form-control ng-model=complements.reference typeahead="item for item in complements.references | filter:$viewValue | limitTo:6" autocomplete=off placeholder=Referencia typeahead-position=shoes.thPosition name=creference required></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=complements.brand placeholder=Marca></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=complements.color typeahead="item as item.color for item in colors | filter:$viewValue | limitTo:8" autocomplete=off typeahead-template-url=searchAutocompleteTpl.html placeholder=Color typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.ticketsComplementsForm.needsAttention(ticketsComplementsForm.cprice)}"><input type=number class=form-control ng-model=complements.price placeholder=Precio name=cprice min=0 required></div></td><td class=active><div class=input-group-sm ng-class="{\'has-error\': kz.ticketsComplementsForm.needsAttention(ticketsComplementsForm.cquantity)}"><input type=number class=form-control ng-model=complements.quantity placeholder=Cantidad name=cquantity min=1 required></div></td><td class=active><button class="btn btn-default btn-sm" type=button data-ng-click=complements.reset()><span class="glyphicon glyphicon-trash"></span></button></td><td class=active><input type=submit class="btn btn-primary btn-sm" value=Añadir></td></tr></tbody></table></form></div></div></div></tab><tab heading=Tickets><div class="panel panel-default"><div class=panel-body><div class=table-responsive><table class="table text-center searchable"><tbody><tr><td class=active><div class=input-group-sm><input class=form-control ng-model=tickets.code typeahead="item for item in tickets.codes | filter:$viewValue | limitTo:10" autocomplete=off placeholder=Código typeahead-on-select=tickets.pagination.search() data-ng-change=tickets.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=tickets.date placeholder=Fecha data-ng-change=tickets.pagination.search()></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=tickets.employee typeahead="item for item in tickets.employees | filter:$viewValue | limitTo:10" autocomplete=off placeholder=Empleado typeahead-on-select=tickets.pagination.search() data-ng-change=tickets.pagination.search() typeahead-position=shoes.thPosition></div></td><td class=active><div class=input-group-sm><input class=form-control ng-model=tickets.state typeahead="item for item in tickets.states | filter:$viewValue | limitTo:8" autocomplete=off placeholder=Estado data-ng-change=tickets.pagination.search() typeahead-position=shoes.thPosition typeahead-on-select=tickets.pagination.search()></div></td><td class=active><button class="btn btn-default btn-sm" type=button data-ng-click=tickets.reset()><span class="glyphicon glyphicon-trash"></span></button> <button type=button class="btn btn-primary btn-sm" ng-click=tickets.setToday()>Hoy</button></td></tr></tbody></table></div><div class=table-responsive data-ng-show="tickets.pagination.totalItems > 0"><table class="table text-center"><thead><tr><th>Código</th><th>Fecha</th><th>Empleado</th><th>Estado</th><th>Acción</th></tr></thead><tbody><tr data-ng-repeat="item in tickets.items" data-ng-class="{active: ($index%2)==0}"><td>{{item.code}}</td><td>{{tickets.parseDate(item.date)}}</td><td>{{item.employee}}</td><td>{{item.status}}</td><td><button type=button class="btn btn-danger btn-sm" data-ng-show="item.status == \'RESERVADO\'" data-ng-click=tickets.abortTicket(item.code)>Anular</button> <a ui-sref="tickets.reserve({ code: item.code })" class="btn btn-success btn-sm" data-ng-show="item.status == \'RESERVADO\'">Terminar</a> <a ui-sref="tickets.return({ code: item.code })" class="btn btn-danger btn-sm" data-ng-show="item.status == \'VENDIDO\'">Devolver</a> <button type=button class="btn btn-success btn-sm" data-ng-show="item.status == \'VENDIDO\'" data-ng-click=tickets.reprintTicket($index)>Reimprimir</button></td></tr></tbody></table></div><div class=text-center data-ng-show="tickets.pagination.pages > 1"><pagination boundary-links=true total-items=tickets.pagination.totalItems max-size=tickets.pagination.maxSize items-per-page=tickets.pagination.itemsPerPage page=tickets.pagination.currentPage class=pagination-sm previous-text=&lsaquo; next-text=&rsaquo; first-text=&laquo; last-text=&raquo; on-select-page=tickets.pagination.setPage(page) num-pages=tickets.pagination.pages></pagination></div></div></div></tab></tabset></div></div><div class="col-xs-12 col-md-3" data-ng-show="ticketTotal != 0 || oldTicketActived"><div class="panel panel-default"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Resumen Venta</h3></div><div class=panel-body><div class=text-center><div class=form-group><label class=control-label for=ticket_total style=font-size:28px>TOTAL</label><div class=input-group><input class="form-control total-ticket" id=ticket_total data-ng-model=ticketTotal disabled><span class=input-group-addon>&euro;</span></div></div><div class="form-group has-success"><label class=control-label for=ticket_received style=font-size:28px>ENTREGA</label><div class=input-group><input class="form-control total-ticket" style=background-color:#D7EFDB data-ng-model=ticketReceived id=ticket_received data-ng-change=computeExchange() data-ng-disabled="ticketPM != \'cash\'"><span class=input-group-addon>&euro;</span></div></div><div class="form-group has-error"><label class=control-label for=ticket_returned style=font-size:28px>CAMBIO</label><div class=input-group><input class="form-control total-ticket" style=background-color:#f2dede data-ng-model=ticketReturned id=ticket_returned disabled><span class=input-group-addon>&euro;</span></div></div></div></div><div class=panel-footer></div></div><div class="panel panel-default"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Forma de Pago</h3></div><div class=panel-body><div><div class=radio><label for=ticket_paymethod_cash><input type=radio id=ticket_paymethod_cash data-ng-model=ticketPM value=cash>Efectivo</label></div><div class=radio><label for=ticket_paymethod_credit><input type=radio id=ticket_paymethod_credit data-ng-model=ticketPM value=credit>Tarjeta Crédito</label></div><div class=radio><label for=ticket_paymethod_voucher><input type=radio id=ticket_paymethod_voucher data-ng-model=ticketPM value=voucher>Cheque Vale</label></div></div></div><div class=panel-footer></div></div></div></div></div>'),a.put("/static/partials/tickets_reserve.html",'<div class="panel panel-default panel-custom"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Tu Reserva: {{code}}</h3><div class="btn-group pull-right"><button class="btn btn-default" data-ng-click=cancel()>Nuevo Ticket</button> <button class="btn btn-default" data-ng-click=$parent.tickets.abortTicket(code)>Anular Reserva</button> <button class="btn btn-default" data-ng-disabled="($parent.ticketPM == \'cash\' && !$parent.hasPaid()) || $parent.processingTicket" data-ng-click=saveTicket()>Finalizar Reserva</button></div></div><div class=panel-body><div class=table-responsive><table class="table text-center"><thead><tr><th>Referencia</th><th>Descripción</th><th>Cantidad</th><th>PVP</th><th>Dto.</th><th>Subtotal</th></tr></thead><tbody><tr data-ng-repeat="item in savedProducts" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.description}}</td><td>{{item.quantity}}</td><td>{{item.price}}</td><td>{{item.discount}}</td><td>{{item.subtotal}}</td></tr></tbody></table></div></div><div class="panel-footer clearfix"><div class=pull-left ng-show="$parent.products.length == 0"><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Impuesto (%)</span><input type=number class=form-control min=0 max=21 ng-model=savedTicketTax step=1 style=width:70px disabled></div><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Descuento (%)</span><input type=number class=form-control min=0 ng-model=savedTicketDiscount step=1 style=width:70px disabled></div></div><div class=pull-right><p style=font-weight:bold;font-size:15px;position:relative;top:5px>TOTAL RESERVA: {{totalAdjusted()}}</p></div></div></div><div class="panel panel-default panel-custom" data-ng-show="$parent.products.length > 0"><div class="panel-heading clearfix"><h3 class=panel-title>Añadir a la Reserva</h3></div><div class=panel-body><div class=table-responsive><table class="table text-center"><thead><tr><th>Referencia</th><th>Descripción</th><th>Cantidad</th><th>PVP</th><th>Dto.</th><th>Subtotal</th><th>Quitar</th></tr></thead><tbody><tr data-ng-repeat="item in $parent.products" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.description}}</td><td><span class="glyphicon glyphicon-chevron-left pointer" ng-show="item.quantity > 1 && !$parent.changingQty" ng-click="$parent.decQty($index,item.type == \'s\')"></span> {{item.quantity}} <span class="glyphicon glyphicon-chevron-right pointer" ng-show="(item.shoe_qty > 0 && !$parent.changingQty) || item.type == \'c\'" ng-click="$parent.incQty($index,item.type == \'s\')"></span></td><td>{{item.price}}</td><td><input ng-model=item.discount class=inline-editing-inactive data-ng-change=$parent.applySubRate($index)></td><td>{{item.subtotal}}</td><td><button type=button class="btn btn-danger btn-sm" data-ng-click="$parent.removeFromTicket($index,item.type == \'s\')"><span class="glyphicon glyphicon-remove"></span></button></td></tr></tbody></table></div></div><div class="panel-footer clearfix"><div class=pull-left><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Impuesto (%)</span><input type=number class=form-control min=0 max=21 ng-model=$parent.ticketTax step=1 style=width:70px data-ng-disabled="$parent.products.length == 0" data-ng-change=$parent.applyRate(true)></div><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Descuento (%)</span><input type=number class=form-control min=0 ng-model=$parent.ticketDiscount step=1 style=width:70px data-ng-disabled="$parent.products.length == 0" data-ng-change=$parent.applyRate(false)></div></div><div class=pull-right><p style=font-weight:bold;font-size:15px;position:relative;top:5px>TOTAL VENTA: {{$parent.ticketTotal - totalAdjusted()}}</p></div></div></div>'),a.put("/static/partials/tickets_return.html",'<div class="panel panel-default panel-custom"><div class="panel-heading clearfix"><h3 class="panel-title pull-left">Devolución de Stock: {{code}}</h3><div class="btn-group pull-right"><button class="btn btn-default" data-ng-click=cancel()>Nuevo Ticket</button> <button class="btn btn-default" data-ng-disabled="($parent.ticketPM == \'cash\' && !$parent.hasPaid()) || $parent.processingTicket || $parent.oldTicketInfo.total == 0" data-ng-click=returnTicket()>Finalizar Devolución</button></div></div><div class=panel-body><div class=table-responsive><table class="table text-center"><thead><tr><th>Referencia</th><th>Descripción</th><th>Cantidad</th><th>PVP</th><th>Dto.</th><th>Subtotal</th><th>Devolver</th></tr></thead><tbody><tr data-ng-repeat="item in returnProducts" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.description}}</td><td><span class="glyphicon glyphicon-chevron-left pointer" ng-show="item.quantity > 1" ng-click=decReturnQty($index)></span> {{item.quantity}} <span class="glyphicon glyphicon-chevron-right pointer" ng-show="item.quantity < item.totalQuantity" ng-click=incReturnQty($index)></span></td><td>{{item.price}}</td><td>{{item.discount}}</td><td>{{item.subtotal}}</td><td><button type=button class="btn btn-sm btn-default" style=width:40px;height:30px ng-model=item.returned ng-click=returnItem($index) btn-checkbox=""><span class="glyphicon glyphicon-remove" ng-show=item.returned></span></button></td></tr></tbody></table></div></div><div class="panel-footer clearfix"><div class=pull-left><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Impuesto (%)</span><input type=number class=form-control min=0 max=21 ng-model=returnTicketTax step=1 style=width:70px disabled></div><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Descuento (%)</span><input type=number class=form-control min=0 ng-model=returnTicketDiscount step=1 style=width:70px disabled></div></div><div class=pull-right><p style=font-weight:bold;font-size:15px;position:relative;top:5px>TOTAL DEVOLUCIÓN: {{returnTicketTotal}}</p></div></div></div><div class="panel panel-default panel-custom" data-ng-show="$parent.products.length > 0"><div class="panel-heading clearfix"><h3 class=panel-title>Añadir a la Devolución</h3></div><div class=panel-body><div class=table-responsive><table class="table text-center"><thead><tr><th>Referencia</th><th>Descripción</th><th>Cantidad</th><th>PVP</th><th>Dto.</th><th>Subtotal</th><th>Quitar</th></tr></thead><tbody><tr data-ng-repeat="item in $parent.products" data-ng-class="{active: ($index%2)==0}"><td>{{item.reference}}</td><td>{{item.description}}</td><td><span class="glyphicon glyphicon-chevron-left pointer" ng-show="item.quantity > 1 && !$parent.changingQty" ng-click="$parent.decQty($index,item.type == \'s\')"></span> {{item.quantity}} <span class="glyphicon glyphicon-chevron-right pointer" ng-show="(item.shoe_qty > 0 && !$parent.changingQty) || item.type == \'c\'" ng-click="$parent.incQty($index,item.type == \'s\')"></span></td><td>{{item.price}}</td><td><input ng-model=item.discount class=inline-editing-inactive data-ng-change=$parent.applySubRate($index)></td><td>{{item.subtotal}}</td><td><button type=button class="btn btn-danger btn-sm" data-ng-click="$parent.removeFromTicket($index,item.type == \'s\')"><span class="glyphicon glyphicon-remove"></span></button></td></tr></tbody></table></div></div><div class="panel-footer clearfix"><div class=pull-left><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Impuesto (%)</span><input type=number class=form-control min=0 max=21 ng-model=$parent.ticketTax step=1 style=width:70px data-ng-disabled="$parent.products.length == 0" data-ng-change=$parent.applyRate(true)></div><div class="input-group input-group-sm pull-left"><span class=input-group-addon>Descuento (%)</span><input type=number class=form-control min=0 ng-model=$parent.ticketDiscount step=1 style=width:70px data-ng-disabled="$parent.products.length == 0" data-ng-change=$parent.applyRate(false)></div></div><div class=pull-right><p style=font-weight:bold;font-size:15px;position:relative;top:5px>TOTAL VENTA: {{$parent.ticketTotal - $parent.oldTicketInfo.total}}</p></div></div></div>')
}]);